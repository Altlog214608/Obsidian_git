### 전체 개요

**`digitalscent-kiosk`는 “향(Perfume) 키오스크”용 Electron + React 앱**입니다.  
- **데스크톱 앱(Electron)** 으로 실행되면서, **시리얼 포트로 디스펜서(드림빌더)와 통신**하고, **라벨 프린터(Brother QL-800)** 로 라벨을 출력합니다.  
- 동시에, **웹 전용 버전**도 따로 빌드해서 **Cloudflare Pages** 에 배포할 수 있게 되어 있습니다.

---

### 1. 루트(프로젝트 최상위) 구조

- **`src/`**: 실제 앱 소스 코드 대부분이 있는 곳  
- **`build/`**: 앱 빌드 시 필요한 리소스(아이콘, entitlements 등)  
- **`resources/`**: 런타임 리소스 (아이콘 등)  
- **`docs/`**: 하드웨어 연결, 레거시 문서, QR 최적화, 사용자 추적 관련 문서  
- **`scripts/`**: 빌드/설치/배포 등에 쓰이는 스크립트  
- **빌드/설정 관련 파일들**:
  - `package.json`: npm 패키지와 실행 스크립트 정의
  - `electron.vite.config.ts`: Electron(main/preload/renderer) 번들 설정
  - `vite.config.ts`: 웹만 빌드할 때 사용하는 Vite 설정
  - `electron-builder.yml`: Windows/Mac/Linux 설치 파일 만드는 설정
  - `wrangler.toml`: Cloudflare Pages 배포 설정
  - `tsconfig*.json`: TypeScript 설정 (Node용, Web용 분리)
  - `eslint.config.mjs`, `.prettierrc.yaml`: 코드 스타일/포맷팅 설정

---

### 2. `src/` 내부 구조

#### 2-1. `src/main/` – Electron 메인 프로세스

- **역할**:  
  - 앱 실행/종료, 창 띄우기  
  - 하드웨어(시리얼 디바이스, 디스펜서, 라벨 프린터) 제어  
  - 설정 저장, 로그 기록, 자동 실행, 자동 업데이트 등
- **중요 파일**:
  - `index.ts`: 메인 프로세스 진입점
- **하위 `hardware/` 폴더**:
  - `serial.ts`: 시리얼 포트 연결/송수신을 담당하는 `SerialManager`
  - `protocol.ts`: 시리얼로 주고받는 디바이스 명령 포맷(프로토콜)
  - `dream-builder-protocol.ts`: “드림빌더” 디스펜서 전용 프로토콜
  - `label-printer.ts`: Brother QL-800 라벨 프린터와 통신하는 로직

**쉽게 말하면**:  
> `src/main/` = “키오스크 PC가 디스펜서·프린터랑 직접 이야기하는 뇌”

---

#### 2-2. `src/preload/` – Preload 스크립트

- **역할**:  
  - Renderer(화면)에서 직접 Node/Electron API를 못 쓰기 때문에,  
  - `contextBridge` 를 통해 **안전한 브리지 API**를 제공합니다.
- **주요 기능**:
  - 시리얼/프로토콜/라벨 프린터 관련 API 노출
  - 설정 저장(store), 로그 가져오기, 자동 실행 설정
  - 앱 업데이트 상태 확인 등

**쉽게 말하면**:  
> `src/preload/` = “화면(React)과 메인(Node)이 서로 안전하게 통신하도록 중간에서 통역해 주는 층”

---

#### 2-3. `src/renderer/` – React 기반 UI (키오스크 화면)

구조는 대략 다음과 같이 나뉩니다:

- **`index.html`**: 렌더러 HTML 템플릿 (실제 화면의 껍데기)
- **`public/`**: Lottie 애니메이션, 이미지 등 정적 리소스
- **`src/`** (여기 안이 React 앱 핵심):
  - **`pages/`**: 실제 라우팅되는 페이지들  
    - 예: `Home`, `CustomExperience`, `QuickExperience`, `Checkout` 등
  - **`components/`**: 공용/재사용 UI 조각들 (버튼, 모달, 카드, 슬라이더 등)
  - **`context/`**:
    - 테마, 토스트, 뷰포트(9:16, 16:10 등 화면 비율), 키오스크 설정 등 전역 상태
  - **`hooks/`**: 커스텀 훅 (예: 키오스크 모드 감지, 하드웨어 상태, 타이머 등)
  - **`utils/`**: 공통 유틸 함수들 (포맷팅, 계산, 공용 상수 등)
  - **`config/`**: 환경설정/상수/엔드포인트 같이 환경별로 달라질 수 있는 값
  - **`i18n/`**: 다국어 설정 (한국어/영어 등 번역 리소스)
  - **`tracking/`**: Mixpanel 등 사용자 행동 추적용 로직
  - **`services/`**: 추천 엔진 등 비즈니스 로직/서비스 모듈

**쉽게 말하면**:  
> `src/renderer/` = “사용자가 실제로 보는 모든 화면과, 그 화면의 상태/번역/추적을 담당하는 부분”

---

### 3. 빌드·실행 흐름 (명령어 기준)

`package.json` 기준으로 대표적인 스크립트 흐름은 다음과 같습니다:

- **`npm run dev`**
  - Electron 개발 모드 실행 (HMR 지원)
  - 메인/프리로드/렌더러 모두 개발용 번들
- **`npm run dev:web`**
  - Electron 없이, **웹만** 로컬 개발 서버로 띄움
- **`npm run build`**
  - Electron 앱을 프로덕션용으로 빌드 (배포용 번들 생성)
- **`npm run build:web`**
  - 웹 버전만 빌드해서 `dist/` 폴더 생성
- **`npm run deploy`**
  - `build:web` 후 Cloudflare Pages로 배포
- **`npm run build:win`**
  - Windows 설치 파일(NSIS) 생성

---

### 4. 전체를 한 줄로 정리하면

- **Electron(Main/Preload) + React(Renderer)** 구조의 향 키오스크 앱이고,  
- **하드웨어 제어는 `src/main/` + `src/preload/`,  
  UI/경험(flow)은 `src/renderer/`** 에 모여 있으며,  
- 하나의 코드베이스로 **데스크톱 앱(Electron)** 과 **웹 앱(Cloudflare Pages)** 을 동시에 관리하는 구조입니다.

---

원하시면 다음 단계로  
- `src/renderer/src/pages/` 안의 페이지 흐름(고객 동선),  
- 또는 `src/main/hardware/` 프로토콜 구조(어떤 명령을 언제 보내는지)  
를 **다이어그램 형태로** 더 자세히 풀어서 설명해 드릴게요.