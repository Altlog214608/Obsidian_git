좋아, “정답은 반드시 포함 + 3지선다 랜덤 + 오답 2개 랜덤 + 유지보수는 정답 텍스트만 바꾸면 됨”을 만족하는 **한 번에 붙여 넣는 유틸**로 정리했어.  
핵심은 **발향 스텝(= `scent>0`)에만** 적용하고, 그 스텝에 `answer_text`를 하나만 적어두면 나머지는 자동으로 채워줘.

---

### 1) 설정 + 함수 (dsTrainID.py 상단 유틸 영역에 추가)

```python
# === 선택지 랜덤화를 위한 설정값 ===
import random

# 현재 사용 중인 "향 리스트"(정답/오답 풀에 함께 사용)
SCENT_POOL = [
    '장미','초콜릿','생강','멜론','소나무','베이비파우더',
    '녹차','홍삼','복숭아','재/연기','페퍼민트','비누'
]

# 장면들에 이미 쓰고 있는 일반 오답(이미지 리소스가 있는 것만 넣으세요)
EXTRA_DISTRACTORS = [
    '잔디','케챱','양파','가죽','페인트','수박','당근','땅콩',
    '꿀','허브','고구마','로즈마리','쑥','유칼립투스','사과','오렌지',
    '포도','숯불고기','마늘','핫초코','신문지','계란','레몬','딸기'
]

# 필요 시 표시 텍스트 ↔ 이미지 키 매핑(파일명이 다를 때만 추가)
ASSET_KEY_MAP = {
    # '재/연기': '재연기',
    # '베이비파우더': '파우더',
    # '귤(오렌지/감귤)': '오렌지',
}

def _asset_key(label: str) -> str:
    return ASSET_KEY_MAP.get(label, label)

def randomize_scent_choice_step(step: dict, *, use_extra_decoys=True, seed=None):
    """
    발향(scent>0) + choice_3/choice_4 스텝을 3지선다로 랜덤화.
    step['answer_text'] 가 있으면 그걸 정답으로, 없으면 SCENT_POOL에서 scent번호로 추정(권장X).
    """
    lt = step.get('layout_type', '')
    if step.get('scent', 0) <= 0:
        return
    if lt not in ('choice_3', 'choice_4'):
        return

    # 1) 정답 텍스트
    correct = step.get('answer_text')
    if not correct:
        # fallback: scent → SCENT_POOL (1-based 가정). 정확히 맞추려면 answer_text를 넣으세요.
        idx = step['scent'] - 1
        if 0 <= idx < len(SCENT_POOL):
            correct = SCENT_POOL[idx]
        else:
            return  # 정답 추정 불가

    # 2) 오답 풀
    pool = SCENT_POOL + (EXTRA_DISTRACTORS if use_extra_decoys else [])
    # 중복 제거 + 정답 우선 보장
    seen = set()
    pool = [x for x in pool if (x not in seen) and not seen.add(x)]
    # 정답 제외
    candidates = [p for p in pool if p != correct]
    if len(candidates) < 2:
        return

    # 3) 오답 2개 랜덤
    rnd = random.Random(seed if seed is not None else hash((step.get('sound'), step.get('head_title'), step.get('scent'))))
    distractors = rnd.sample(candidates, 2)

    # 4) 정답+오답 섞기
    choices = [correct] + distractors
    rnd.shuffle(choices)

    # 5) 할당(3지선다 강제)
    step['layout_type'] = 'choice_3'
    for i, txt in enumerate(choices, start=1):
        step[f'label_select_{i}'] = txt
        step[f'img_btn{i}'] = _asset_key(txt)
    # 4번은 비우기(렌더러가 그리지 않지만 깔끔하게)
    step['label_select_4'] = ''
    step['img_btn4'] = ''
```

---

### 2) 발향 스텝에 `answer_text`만 추가

각 시나리오에서 **“향을 느껴보시고…”** 하는 **발향 스텝**(=`scent>0`이고 `choice_3/4`)에 **정답 텍스트 한 줄**만 넣어주세요.

예) `id_train_scene_1`의 2번째 스텝(장미):

```python
{
    'layout_type':'choice_3',
    'img_bg':'bg_s_01_01',
    'img_btn1':'잔디','img_btn2':'케챱','img_btn3':'장미','img_btn4':'양파',
    'head_title':'Farm',
    'body_text':'향을 느껴보시고 짐작해보세요.\n어떤 향을 느끼셨습니까?',
    'label_select_1':'잔디','label_select_2':'케챱','label_select_3':'장미','label_select_4':'양파',
    'sound':'train_id_01_02',
    'scent':1,
    'answer_text':'장미',           # ✅ 추가: 정답 텍스트(한 곳만 바꾸면 유지보수 끝)
},
```

예) `id_train_scene_2`의 2번째 스텝(현재 콘텐트가 레몬 기반이면 레몬로):

```python
{
    'layout_type':'choice_3',
    ...
    'scent':2,
    'answer_text':'레몬',           # ✅ 정답 고정
},
```

> **포인트**
> 
> - `scent` 번호와 실제 정답 텍스트가 다를 수 있으니, **반드시 `answer_text`를 넣는 게 안전**합니다.
>     
> - 이미지 파일명이 텍스트와 다르면 `ASSET_KEY_MAP`에만 한 번 등록하세요.
>     

---

### 3) 모든 TrainID 씬에 적용 (정의가 끝난 뒤 한 번 호출)

```python
# id_train_scene_1 ~ 8 정의가 모두 끝난 뒤에 호출
_all_train_scenes = [
    id_train_scene_1, id_train_scene_2, id_train_scene_3, id_train_scene_4,
    id_train_scene_5, id_train_scene_6, id_train_scene_7, id_train_scene_8
]

for scene in _all_train_scenes:
    for step in scene:
        randomize_scent_choice_step(step, use_extra_decoys=True)
```

> 이렇게 하면 **앱 실행 시점에 한 번** 각 발향 스텝이 3지선다로 랜덤 셋업됩니다.  
> 매 실행마다 섞고 싶지 않다면, `seed`를 날짜/세션 기준으로 고정해주면 돼요.

---

### 체크리스트

- 발향 스텝(`scent>0` & `choice_3/4`)마다 `answer_text` 한 줄만 넣으면 끝.
    
- 3개 보기는 매번 섞이고, 정답은 반드시 포함.
    
- 오답 2개는 `SCENT_POOL + EXTRA_DISTRACTORS`에서 랜덤 샘플.
    
- 이미지 파일명이 다르면 `ASSET_KEY_MAP`에서 매핑.
    

원하면 내가 너의 `id_train_scene_1~8`에서 발향 스텝들을 찾아 **`answer_text`까지 채운 패치 버전**으로 한 번에 정리해서 드릴 수도 있어.