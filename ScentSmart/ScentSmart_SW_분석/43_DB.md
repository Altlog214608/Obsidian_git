
# 1) 어떤 DB를 쓰나 (파일/테이블/암호화)

- **파일**: `dsTestDB.db` (SQLite) 를 사용합니다. 상수 `DS_TEST_DB = "dsTestDB.db"`로 지정.
    
- **주요 테이블**
    
    - `DS_TEST_SUBJECT`: 대상자(이름/생년월일/성별) 보관. 생성은 `createTableSubject()`가 수행.
        
    - `DS_TEST_ID`: 인지(식별) 검사 결과 보관. 생성은 `createTableTestID()`가 수행. (이름/생년월일/성별/검사일시/점수 + 문항별 정답·응답 1~12)
        
- **민감정보 암호화**: 이름/생년월일/성별은 저장 전 `dsCrypto.encryptMessage(...)`로 암호화하고, 읽을 때 복호화해서 UI에 보여줍니다. (예: `insertTableTestID`와 각 `select...` 함수 내부)
    

# 2) 앱 시작 시 DB 준비 (테이블 생성)

- UI/앱 초기화 시 **`uiDlgDB()`**에서 테이블을 만들어 둡니다:  
    `dsTestDB.createTableSubject()` → `dsTestDB.createTableTestID()` 순으로 호출.
    

# 3) 대상자(피검자) 관리 동작

- **추가**: `insertTableSubject(name, birth, gender)` → 암호화 후 INSERT.
    
- **중복확인**: `checkTableSuject(name, birth, gender)` → (암호화 키로) 존재 여부 SELECT EXISTS.
    
- **삭제**: `deleteTableSubject(name, birth, gender)` → (암호화 키로) DELETE.
    
- **조회(리스트)**: `selectTableSubject()` → SELECT 후 복호화해서 반환.
    
- (UI 쪽) 대상자 다이얼로그는 `uiDlgSubject(...)`에서 버튼 핸들러 연결(검색/추가/삭제/다음 화면).
    

# 4) 인지(식별) 검사 결과 저장 동작

1. **점수 계산 + 결과 배열 준비**  
    시험 종료 시 내부에서 점수를 계산하고, `id_results`(표형 데이터)를 보유합니다. 그걸 DB 입력용 1차원 배열로 풀어 담는 게 **`dbSaveTestID(id_results)`** 입니다.
    
    - 메타 4칸: `[이름, 생년월일, 성별, 검사일시(now)]` 지정.
        
    - 문항별로 **정답-응답**을 순서대로 칸에 채워 넣고, 맞힌 개수로 **점수** 계산.
        
2. **DB INSERT**  
    최종 배열을 `dsTestDB.insertTableTestID(*tuple(db_results))`로 전달 → 내부에서 **이름/생년/성별은 암호화** 후 INSERT.
    

# 5) 인지(식별) 검사 결과 불러오기 동작

- **한 건 읽기(키로 조회)**: 이름/생년/성별/검사시각을 키로 **`selectTableTestIDOne(...)`** 실행 → 암호화 키로 SELECT 후 복호화해서 한 행을 돌려줍니다.
    
- **UI 채우기**: 위 결과를 받아 **`makeSubjectTestRecordIdentification(name, birth, gender, test_time)`**에서 호출하고, 없으면 에러 메시지, 있으면 `dbLoadTestId(...)`로 표 형태로 변환해 레코드 화면을 구성합니다.
    
- (리스트에서 더블클릭/선택 시) **`cellTestIDTableCurrent(...)`** → 선택된 행에서 키(이름/생년/성별/검사일시)를 뽑아 위 함수들을 호출해 **기록 보기 화면**으로 전환합니다.
    

# 6) 정리: 실제 실행 순서(대표 시나리오)

1. 앱/메뉴 진입 → **`uiDlgDB()`**로 테이블 생성(없으면).
    
2. 대상자 등록 화면에서 **추가/삭제/검색** 수행(암호화 저장·복호화 표시).
    
3. 인지(식별) 검사 진행 → 결과 테이블(`id_results`) 생성.
    
4. **저장 버튼** → **`dbSaveTestID(...)`** → 내부 `insertTableTestID(...)`로 DB INSERT(이름/생년/성별 암호화, 점수와 문항별 정답/응답 저장).
    
5. 대상자 기록 목록에서 특정 행을 선택 → **`cellTestIDTableCurrent(...)`** → **`selectTableTestIDOne(...)`**로 1건 로드 → **`dbLoadTestId(...)`**로 표 구성 후 화면 표시.
    

필요하면, 실제 **함수명/인터페이스 위치(파일/함수)** 기준으로 더 디테일하게 “이벤트 → DB호출” 매핑도 그려줄게요. 원하는 시나리오(예: “대상자 추가부터 기록 조회까지 버튼 플로우”)를 말해주면 코드 흐름도로도 정리해줄 수 있어요.