오늘은 치매기기 이미지 작업해야지

그리고 패킹해놓자

가능해! 이미 엑셀(xlsx)로 결과를 저장하고 있으니, “저장 직후 바로 인쇄” 버튼/질문만 붙이면 돼. 운영체제별로 방법이 조금 다른데, 윈도우+엑셀 설치 환경이면 가장 깔끔하게 돌아간다.

# 해법 요약

1. 저장 함수 끝에서 “지금 인쇄할까요?”를 물어보고,
    
2. `win32com`(pywin32)로 엑셀을 무표시로 열어서 `PrintOut()` 호출 → 프린터로 바로 출력.  
    (엑셀이 없거나 mac/Linux라면: 임시로 PDF 내보내기 후 일반 인쇄 다이얼로그 열기 방식 권장)
    

아래는 네 현재 코드에 바로 붙여 넣을 수 있는 최소 수정안이야.

---

## 1) 저장 직후 인쇄 물어보기 (기록/리포트 저장 함수에 추가)

지금 `uiTestIdentificationRecordSave()`에서 경로를 받고 `saveReportIdentification(save_path)`로 저장한 뒤 완료 메시지를 띄우고 있지? 그 바로 뒤에 “인쇄할까요?”를 붙이면 돼. (해당 저장 로직은 여기 부분 참고: 저장경로 선택→리포트 저장 호출 흐름)  
`saveReportIdentification()`은 xlsxwriter로 보고서 시트를 만드는 함수야.

```python
# ScentSmart.py 안의 UiDlg 클래스
from PySide6.QtWidgets import QMessageBox

def uiTestIdentificationRecordSave(self):
    import os
    from datetime import datetime
    from PySide6.QtWidgets import QFileDialog, QMessageBox

    try:
        # ... (기존 저장 경로/파일명 결정 코드 그대로)
        # save_path 얻은 뒤:
        if not save_path:
            return

        # 실제 저장
        self.saveReportIdentification(save_path)

        # 저장 완료 알림
        QMessageBox.information(self, "완료", "파일 저장이 완료되었습니다.")

        # 👉 저장 직후 바로 인쇄 여부 묻기
        ret = QMessageBox.question(self, "인쇄", "지금 바로 인쇄할까요?")
        if ret == QMessageBox.Yes:
            self.print_excel(save_path)  # 아래 2) 함수 사용

    except Exception as e:
        QMessageBox.warning(self, "오류", f"저장 중 오류: {e}")
```

> 통합 결과 저장 뒤에도 같은 흐름으로 붙일 수 있어요. 예: `uiTestResultsSave()`에서 내부적으로 저장을 끝낸 뒤 인쇄 질문 추가. (통합 저장 트리거는 여기)

---

## 2) 엑셀 파일을 바로 프린트하기 (Windows + Excel 권장)

윈도우에서 엑셀이 설치돼 있다면, `win32com`으로 엑셀을 백그라운드로 열고 인쇄만 쏘면 가장 안정적이야.

```python
# 파일 상단 또는 클래스 위쪽 어딘가에(플랫폼 가드 포함)
import os, platform
from PySide6.QtWidgets import QMessageBox

if platform.system() == "Windows":
    try:
        import win32com.client as win32
    except Exception:
        win32 = None
else:
    win32 = None

def print_excel(self, xlsx_path: str, printer_name: str | None = None, sheet_index: int = 1) -> bool:
    """
    xlsx_path: 인쇄할 엑셀 파일 경로
    printer_name: 지정 프린터명(없으면 기본 프린터)
    sheet_index: 인쇄할 워크시트(1부터)
    """
    # 1) 윈도우 + 엑셀 COM 우선 사용
    if win32 is not None:
        excel = None
        try:
            excel = win32.DispatchEx("Excel.Application")
            excel.Visible = False
            wb = excel.Workbooks.Open(xlsx_path, ReadOnly=True)

            # 인쇄 페이지 자동 맞춤(선택) - 필요 없으면 제거
            ws = wb.Worksheets(sheet_index)
            ws.PageSetup.Zoom = False
            ws.PageSetup.FitToPagesWide = 1
            ws.PageSetup.FitToPagesTall = False

            if printer_name:
                excel.ActivePrinter = printer_name  # 지정 프린터로

            ws.PrintOut()  # 조용히 바로 출력
            wb.Close(False)
            excel.Quit()
            QMessageBox.information(self, "인쇄", "인쇄 명령을 보냈습니다.")
            return True
        except Exception as e:
            # COM 실패 시 Excel 프로세스 정리 시도
            try:
                if excel is not None:
                    excel.Quit()
            except:
                pass
            QMessageBox.warning(self, "인쇄 실패", f"Excel COM 인쇄 실패: {e}")

    # 2) (대안) 윈도우에서 연결 앱으로 ‘인쇄’ 동사 실행 (연결앱이 Excel이면 동작)
    try:
        if platform.system() == "Windows":
            os.startfile(xlsx_path, "print")
            QMessageBox.information(self, "인쇄", "연결된 앱으로 인쇄 명령을 보냈습니다.")
            return True
    except Exception as e:
        QMessageBox.warning(self, "인쇄 실패", f"연결앱 인쇄 실패: {e}")

    # 3) 그 외 OS: PDF로 변환 후 일반 인쇄(추가 구현 필요)
    QMessageBox.information(self, "안내", "이 OS에서는 PDF로 변환 후 인쇄하는 경로를 권장합니다.")
    return False
```

> 프린터를 고르고 싶다면 `printer_name`에 시스템 프린터명을 넘기면 된다(예: “HP LaserJet…”). 필요하면 `win32print.EnumPrinters`로 목록을 띄우는 작은 다이얼로그도 붙여줄 수 있어.

---

## 3) (선택) 크로스플랫폼 경로

- **PDF로 내보내기 → Qt 인쇄 대화상자:**  
    엑셀을 바로 인쇄하기 어렵다면, 보고서 자체를 PDF로 생성(엑셀 대신 PDF 생성 루틴 추가 or Windows라면 Excel의 `ExportAsFixedFormat`) 후 `QPrintDialog`로 출력하는 방법이 가장 호환성이 좋아.
    
- **장점:** macOS/Linux에서도 동작.
    
- **단점:** 지금은 xlsxwriter로만 보고서를 만들고 있으니, PDF 생성을 별도 경로로 만들어야 함.
    

---

## 어디에 붙이면 좋을까?

- **기록 리포트 화면의 [저장] 버튼:** 이미 `uiTestIdentificationRecordSave()`가 저장을 담당 → 저장 후 바로 인쇄 묻기(위 1) 코드).
    
- **식별/문턱/인지 통합 결과의 [저장] 버튼:** `uiTestResultsSave()` 안에서 통합 저장이 성공했을 때 동일 로직 추가.
    

---

필요하면 프린터 선택 다이얼로그(프린터 목록 표시), 다중부수 인쇄, 특정 시트만 인쇄 등도 얹어줄 수 있어. 원하는 UX(“무조건 바로 인쇄” vs “물어보고 인쇄”)만 알려주면 그에 맞춰 딱 붙여줄게!


