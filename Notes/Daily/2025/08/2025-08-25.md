AI 추천 결과 편향 

# FrSmart.py

def setUiFindExpDlg(self, number):
    # 배경 이미지 설정 (그대로)
    self.ui_find_exp_dlg.label_background.setStyleSheet(
        dsImage.dsFindDetailImg[number])

    # ✅ URL 파라미터 구성
    try:
        # MBTI 문자열로 변환(선택 personality → MBTI)
        mbti_str = self._convert_personality_to_mbti(getattr(self, 'find_per_range_num', 0))

        # 선택값 수집: (없으면 0으로)
        def nz(x): 
            return int(x) if isinstance(x, (int, float)) else int(x) if str(x).isdigit() else 0

        params = {
            "perfume": number,                                  # 1~12 (추천 결과)
            "gender_id": nz(getattr(self, 'find_gender_range_num', 0)),
            "age_id": nz(getattr(self, 'find_age_range_num', 0)),
            "mbti": mbti_str if mbti_str != 'NONE' else "",     # 없으면 빈 문자열
            "fashion_id": nz(getattr(self, 'find_fashion_range_num', 0)),
            "pref_color_id": nz(getattr(self, 'find_color_range_num', 0)),
            "purpose_id": nz(getattr(self, 'find_purpose_range_num', 0)),
            "category_id": nz(getattr(self, 'find_category_range_num', 0)),

            # 노트 비율(원하면 랜덤/모델값으로 교체 가능)
            "top": 30, "middle": 40, "base": 30,
            "lang": "en",
        }

        # ✅ QR 생성 (모바일 결과 URL로 고정)
        qr_path = dsQRcode.generate_qr_code(
            save_path=f"temp_qr_{number}.png",
            base_url="https://perfume-mobile.vercel.app/result",
            params=params,
        )

        # QR 라벨 배치 (기존 코드 유지)
        if not hasattr(self, 'qr_label'):
            self.qr_label = QtWidgets.QLabel(self.ui_find_exp_dlg)
            self.qr_label.setFixedSize(100, 100)
            self.qr_label.setStyleSheet("border: none; background: transparent;")

        qr_pixmap = QtGui.QPixmap(qr_path)
        self.qr_label.setPixmap(qr_pixmap.scaled(100, 100, Qt.AspectRatioMode.KeepAspectRatio))
        self.qr_label.move(self.ui_find_exp_dlg.width() - 120, 20)
        self.qr_label.show()

    except Exception as e:
        print(f"QR 코드 생성 오류: {e}")
        if hasattr(self, 'qr_label'):
            self.qr_label.hide()


---

# dsQRcode.py

import qrcode
import random
from urllib.parse import urlencode

# 기존 전역 base_url은 보관(레거시)
LEGACY_BASE_URL = "https://hashswim.github.io/perfume_mobile_page/"

# ✅ 새 기본 URL (모바일 결과 페이지)
DEFAULT_RESULT_URL = "https://perfume-mobile.vercel.app/result"

def generate_qr_code(idx=None, save_path=None, *, base_url=DEFAULT_RESULT_URL, params=None):
    """
    params가 있으면 그대로 쿼리로 인코딩하여 QR 생성.
    params가 없으면 (레거시) idx 기반 URL 사용.
    """
    if params and isinstance(params, dict):
        # 빈 값은 제거
        cleaned = {k: v for k, v in params.items() if v not in (None, "", -1)}
        full_url = f"{base_url}?{urlencode(cleaned)}"
    else:
        # 레거시 동작 유지: idx 사용
        if idx is None:
            idx = random.randint(0, 11)
        full_url = f"{LEGACY_BASE_URL}?{urlencode({'idx': idx})}"

    # QR 생성
    qr = qrcode.QRCode(
        version=1,
        error_correction=qrcode.constants.ERROR_CORRECT_L,
        box_size=10,
        border=4,
    )
    qr.add_data(full_url)
    qr.make(fit=True)
    img = qr.make_image(fill_color="black", back_color="white")

    if save_path is None:
        # 파일명: perfume_qr_<timestamp or perfume>.png 등, 필요시 변경
        save_path = "qrcode.png"

    img.save(save_path)
    print(f"[QR] {full_url} -> saved: {save_path}")
    return save_path
