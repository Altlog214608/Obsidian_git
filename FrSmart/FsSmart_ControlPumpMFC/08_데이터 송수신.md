사용자가 문의한 "소프트웨어에서 `write` 함수로 데이터를 보낸 후, 펌웨어에서 데이터를 받는 함수와 그 데이터를 해석하는 부분"에 대해, 지금까지 제공된 `ControlPumpMFC.c`와 관련 파일을 바탕으로 답변드립니다.

---

## 1. 데이터 전송 (write) 후 펌웨어 데이터 수신 함수 위치

- `ControlPumpMFC.c` 내에서 데이터 전송은 `SendToCom(&s_serial)` 함수 호출로 이루어집니다.
    
- `SendToCom()`은 `ConfigCOM.c`에 구현되어 시리얼 포트로 데이터를 전송하는 역할을 하며, 내부적으로는 OS의 통신 API 사용(예: `ComWrt()`).
    
- 데이터 수신은 `ReadFromCom(&s_serial)` 함수에서 수행합니다. 이 함수 역시 `ConfigCOM.c`에 있으며, 시리얼 포트 버퍼에서 데이터를 읽어 들입니다.
    

즉,

- **데이터 보내기:** `SendToCom(&s_serial)`
    
- **데이터 읽기:** `ReadFromCom(&s_serial)`
    

이 둘은 `ControlPumpMFC.c` 내 `ReadRegister_MFC()`, `WriteSingleReg_MFC()`, `SetDutyBoard_MFC()` 등에서 호출되어 각각 MODBUS 명령 패킷을 전송하고 응답을 받도록 되어 있습니다.

---

## 2. 펌웨어에서 받은 데이터 해석 함수

- 수신된 데이터는 `DecodePacket()` 함수가 처리합니다.
    
- `DecodePacket()`은 `ControlPumpMFC.c`에 선언되어 있고, 수신된 패킷을 해석하는 내부 로직이 구현되어 있습니다.
    
- 더 구체적으로, `DecodeData_MFC(unsigned short add, unsigned short qtres)` 함수가 해석 작업을 합니다.
    

`DecodeData_MFC`는 MODBUS 응답 패킷에서 특정 주소 범위(`add`부터 `qtres` 개수) 데이터를 추출하여, 내부 구조체 `s_mfc`의 해당 필드에 값을 저장합니다. 예를 들어,

- 보드 개수(`MFC_NSB`)를 읽은 경우 `s_mfc.tnsbd`에 저장
    
- 펌웨어 버전 등 주요 상태 값을 내부 변수에 할당
    

---

## 3. 요약된 관계 및 흐름

|단계|함수명|역할|
|---|---|---|
|1|`WriteSingleReg_MFC()`, `SetDutyBoard_MFC()`, `ReadRegister_MFC()`|MODBUS 명령 패킷 생성 및 `SendToCom()` 호출하여 데이터 전송|
|2|`SendToCom()` (ConfigCOM.c)|시리얼 포트로 데이터 전송(내부 `ComWrt()` 호출)|
|3|`ReadFromCom()` (ConfigCOM.c)|시리얼 포트에서 응답 데이터 수신|
|4|`DecodePacket()`|수신된 MODBUS 패킷 해석 호출|
|5|`DecodeData_MFC()`|MODBUS 응답 데이터별로 구조체 `s_mfc`에 상태/값 저장|

---

## 추가 참고

- `DecodePacket()` 내부에서는 수신 버퍼의 CRC 검사, 프로토콜별 패킷 필드 체크 등이 수행되며, 정상 패킷일 경우 `DecodeData_MFC()`를 호출해 데이터 내용을 분석합니다.
    
- `DecodeData_MFC()`는 주소 기반으로 분기하며, 읽은 값들을 `s_mfc` 구조체 필드에 저장하여 이후 UI 갱신 및 상태 판단 등에 사용됩니다.
    

---

필요하면, `DecodePacket()`과 `DecodeData_MFC()` 함수의 상세 코드 구조도 설명해 드릴 수 있습니다.

필요한 경우 알려주세요.

1. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/6cbfc816-4686-48c1-8c59-42ef5e5fed3c/ControlPumpMFC.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/6cbfc816-4686-48c1-8c59-42ef5e5fed3c/ControlPumpMFC.c)
2. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/1dcfa4b6-fb5a-454c-86fa-6b84e832e33d/ConfigCOM.h](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/1dcfa4b6-fb5a-454c-86fa-6b84e832e33d/ConfigCOM.h)
3. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/c3d13ac3-7833-439a-b787-4b1411e175b6/FunctionSerial.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/c3d13ac3-7833-439a-b787-4b1411e175b6/FunctionSerial.c)
4. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/d3b94891-0eba-4bb6-a662-9dd0eb3262bd/FunctionSerial.h](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/d3b94891-0eba-4bb6-a662-9dd0eb3262bd/FunctionSerial.h)
5. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/74059703-5049-42d1-9a7d-33d2c35e2372/MODBUS.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/74059703-5049-42d1-9a7d-33d2c35e2372/MODBUS.c)
6. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/cc1b7ae9-bcb7-4db7-b3f6-5d09955b859e/MODBUS.h](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/cc1b7ae9-bcb7-4db7-b3f6-5d09955b859e/MODBUS.h)
7. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/db8d8815-d317-4960-a8d4-b082b9ac407c/ConfigCOM.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/db8d8815-d317-4960-a8d4-b082b9ac407c/ConfigCOM.c)