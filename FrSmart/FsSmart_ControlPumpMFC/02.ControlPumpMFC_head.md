ì¢‹ì•„ìš”.  
ì§€ê¸ˆ ì˜¬ë ¤ì£¼ì‹  ë‘ ë²ˆì§¸ íŒŒì¼ì€ ì „í˜•ì ì¸ **í—¤ë” íŒŒì¼(.h)** ì´ê³ ,  
ì²« ë²ˆì§¸ë¡œ ì£¼ì‹  C íŒŒì¼(`ControlPumpMFC.c`)ì—ì„œ ì‹¤ì œ ë™ì‘ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ í¬í•¨ë˜ëŠ” ì •ì˜(define), êµ¬ì¡°ì²´, ë³€ìˆ˜, í•¨ìˆ˜ ì›í˜•(í”„ë¡œí† íƒ€ì…)ë“¤ì´ ë“¤ì–´ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ì—ì„œ **ì½”ë“œ ë¸”ë¡ë³„ë¡œ ì‰½ê²Œ í’€ì–´ì„œ** ì„¤ëª…ë“œë¦´ê²Œìš”.

---

## 1. í—¤ë” ê°€ë“œ

c

`#ifndef _MFC #define _MFC ... #endif`

- ì´ ë¶€ë¶„ì€ **í—¤ë” ê°€ë“œ(Header Guard)** ì…ë‹ˆë‹¤.
    
- ê°™ì€ í—¤ë” íŒŒì¼ì´ ì—¬ëŸ¬ ë²ˆ í¬í•¨(include)ë˜ì–´ë„ ì¤‘ë³µ ì •ì˜ ì˜¤ë¥˜ê°€ ë‚˜ì§€ ì•Šê²Œ í•©ë‹ˆë‹¤.
    
- `_MFC`ê°€ ì•„ì§ ì •ì˜ë˜ì§€ ì•Šì€ ìƒíƒœë©´ ì•ˆì˜ ë‚´ìš©ì„ ì½ê³ , ì´ë¯¸ ì •ì˜ëë‹¤ë©´ ì•ˆì˜ ë‚´ìš©ì„ ë¬´ì‹œí•©ë‹ˆë‹¤.
    

---

## 2. ëª…ë ¹ì–´(Command) ì •ì˜

c

`#define CMD_RUN   1 #define CMD_CLEAN 2 #define CMD_STOP  3 #define CMD_RUNCL 4   // run & clean #define CMD_CLEAR 5   // duty clear ???`

- íŒí”„ë‚˜ ë°¸ë¸Œ ì œì–´ë¥¼ ìœ„í•œ **ëª…ë ¹ ì½”ë“œ** ìƒìˆ˜ì…ë‹ˆë‹¤.
    
- ì¥ì¹˜ì— MODBUS ê°™ì€ í†µì‹  í”„ë¡œí† ì½œë¡œ ë³´ë‚´ëŠ” ëª…ë ¹ì˜ â€œê°’"ì„ ìƒì§•ì ìœ¼ë¡œ ì‚¬ìš©.
    
    - `CMD_RUN` = ìš´ì „ ì‹œì‘
        
    - `CMD_CLEAN` = í´ë¦¬ë‹ ë™ì‘
        
    - `CMD_STOP` = ì •ì§€
        
    - `CMD_RUNCL` = ìš´ì „ í›„ ë°”ë¡œ í´ë¦¬ë‹
        
    - `CMD_CLEAR` = ë°¸ë¸Œ ìƒíƒœ/ë°ì´í„° ì´ˆê¸°í™”(ì¶”ì •)
        

---

## 3. ì¥ì¹˜ ID

c

`#define MFC_MID 0x01 // main board ID`

- MFC ì¥ì¹˜ì˜ ë©”ì¸ë³´ë“œ ì‹ë³„ ID.
    
- MODBUS í†µì‹ ì—ì„œ ìŠ¬ë ˆì´ë¸Œ ì¥ì¹˜ ì•„ì´ë””ë¡œ 0x01 ì‚¬ìš©.
    

---

## 4. ë ˆì§€ìŠ¤í„° ì£¼ì†Œ ì •ì˜

ì´ ë¶€ë¶„ì´ í•µì‹¬ì…ë‹ˆë‹¤.

## 4.1 ì½ê¸° ì „ìš© Input Register

c

`#define MFC_FVM 0x0FA0 // firmware version Main Board #define MFC_FVS 0x0FA2 // firmware version Sol Board #define MFC_PID 0x0FA4 // product info ... #define MFC_EMS 0x0FBC // EMS status (0=normal, 1=EMS) #define MFC_NSB 0x0FBD // number of Sol boards #define MFC_TMP 0x0FBE // temperature (*10) #define MFC_CGP 0x0FBF // gas pressure (*10) #define MFC_RST 0x0FC5 // run status #define MFC_SBS 0x0FC8 // sol board status #define MFC_SPS 0x0FDC // sol port status`

- ì¥ì¹˜ ë‚´ë¶€ ê°’ë“¤ì„ ì½ê¸° ìœ„í•œ **MODBUS Input Register** ì£¼ì†Œì…ë‹ˆë‹¤.
    
- ì˜ˆ: `MFC_FVM`ì— ì ‘ê·¼í•˜ë©´ ë©”ì¸ë³´ë“œ íŒì›¨ì–´ ë²„ì „ ê°’ì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
- ì˜¨ë„, ì••ë ¥, ë™ì‘ ìƒíƒœ, ë³´ë“œ ê°œìˆ˜ ë“± ì¥ì¹˜ ìƒíƒœ ì •ë³´ë¥¼ ì½ì–´ì˜¤ëŠ” ë° ì‚¬ìš©.
    

---

## 4.2 ì½ê¸°/ì“°ê¸° ê°€ëŠ¥ Holding Register

c

`#define MFC_CMD 0x1068 // ëª…ë ¹ ë ˆì§€ìŠ¤í„° #define MFC_RPW 0x106A // run pump power % #define MFC_CPW 0x106B // clean pump power % #define MFC_POT 0x106C // run pump on time #define MFC_COT 0x106D // clean pump on time #define MFC_RPD 0x106E // run post delay #define MFC_CPD 0x106F // clean post delay #define MFC_PPF 0x1074 // pump PWM frequency #define MFC_VPF 0x1075 // valve PWM frequency #define MFC_SPA 0x1086 // ì²« ë²ˆì§¸ ì†”ë ˆë…¸ì´ë“œ ë³´ë“œ í¬íŠ¸ duty ê°’ ì‹œì‘ ì£¼ì†Œ`

- ì—¬ê¸°ë¡œ ê°’ì„ ì“°ë©´ ì¥ì¹˜ ë™ì‘ì´ ë°”ë€ë‹ˆë‹¤.
    
- ì˜ˆ: `MFC_CMD`ì— `CMD_RUN(1)`ì„ ì“°ë©´ ì‹¤ì œ ìš´ì „ ëª¨ë“œë¡œ ì¥ì¹˜ê°€ ì‘ë™.
    
- PWM ì£¼íŒŒìˆ˜, ë™ì‘ ì‹œê°„, ì§€ì—° ì‹œê°„ ë“± ì¶œë ¥ ë™ì‘ íŒŒë¼ë¯¸í„°ë¥¼ ë³€ê²½ ê°€ëŠ¥.
    
- `MFC_SPA`ëŠ” ë°¸ë¸Œë“¤ì˜ ê°œë³„ Duty(% ì¶œë ¥ ë¹„ìœ¨) ê°’ì„ ì„¤ì •í•˜ëŠ” ì‹œì‘ ì£¼ì†Œ.
    

---

## 5. êµ¬ì¡°ì²´ `S_MFC`

c

`typedef struct {     int tnsbd;         // ì´ ì†”ë ˆë…¸ì´ë“œ ë³´ë“œ ìˆ˜    int tnmfl;         // ì´ ë©€í‹° í”Œë¡œìš° ë¼ì¸ ìˆ˜    double sumduty;    // ì „ì²´ duty í•©ê³„    unsigned short *duty;     // ê° ë°¸ë¸Œ duty ê°’ ì €ì¥    unsigned short *status;   // ê° ë°¸ë¸Œ ìƒíƒœ ê°’ ì €ì¥    int *lhindex;              // UI ì œì–´ìš© ì¸ë±ìŠ¤ (uir íŒŒì¼ì˜ control IDì™€ ì—°ê²°)    int cmdid, power, freq, runtime;    double fscale, offset, coeff[6], *dutyzero;   } S_MFC; S_MFC s_mfc;`

- í”„ë¡œê·¸ë¨ ì „ì²´ì—ì„œ ì‚¬ìš©í•  **ì¥ì¹˜ ìƒíƒœ/ì„¤ì •ê°’ ì €ì¥ êµ¬ì¡°ì²´**.
    
- íŠ¹íˆ `fscale`, `offset`, `coeff[]`ëŠ” duty ê°’ì„ ë¬¼ë¦¬ì ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë³´ì • ê³„ìˆ˜.
    
- `dutyzero[]`ëŠ” í•´ë‹¹ ì±„ë„ì´ ë™ì‘í•˜ì§€ ì•Šì„ ë•Œ ê¸°ì¤€ Duty ê°’.
    

---

## 6. ì „ì—­ ë³€ìˆ˜

c

`int control_handle, acq_handle, file_handle, flag_chart; int flag_cpower, flag_ctime, flag_cfreq; unsigned char modbus_cmd, wait_bytes; char proj_dir[MAX_PATHNAME_LEN];`

- LabWindows/CVI UI í•¸ë“¤(`control_handle`, `acq_handle`) ì €ì¥.
    
- í†µì‹  íŒ¨í‚· ê´€ë ¨ ìƒíƒœ ë³€ìˆ˜(`modbus_cmd`, `wait_bytes`).
    
- ì‹¤í–‰ ê²½ë¡œ(`proj_dir`) ì €ì¥.
    

---

## 7. í•¨ìˆ˜ ì›í˜•(í”„ë¡œí† íƒ€ì…)

c

`void InitProcess(void); void QuitProcess(void); void DecodePacket(void); int DecodeData_MFC(unsigned short add, unsigned short qtres); int InitProcess_MFC(void); void InitConfig_MFC(void); void ReadConfigProVal_MFC(void); void SetDutyBoard_MFC(int sbdindex); void ReadDutyBoard_MFC(int sbdindex); void WriteSingleReg_MFC(unsigned short add, unsigned short value); void WriteMultiReg_MFC(unsigned short add, unsigned short cmdvalue);  void ReadRegister_MFC(unsigned char readcmd,unsigned short add, unsigned short rdreg); void Error_MFC(int errindex);`

- ì¥ì¹˜ ì´ˆê¸°í™”, ì„¤ì • ì½ê¸°/ì“°ê¸°, duty ì œì–´, ì—ëŸ¬ ì²˜ë¦¬ ë“±ì— ì“°ì´ëŠ” í•¨ìˆ˜ë“¤ì˜ ì„ ì–¸ë¶€.
    
- ì‹¤ì œ êµ¬í˜„ì€ ì˜¤ë¦¬ì§€ë„ `.c` íŒŒì¼(`ControlPumpMFC.c`) ì•ˆì— ìˆìŠµë‹ˆë‹¤.
    

---

## ìš”ì•½

- ì´ í—¤ë” íŒŒì¼ì€ **ì¥ì¹˜ ì œì–´ë¥¼ ìœ„í•œ ëª…ë ¹, ë ˆì§€ìŠ¤í„° ì£¼ì†Œ, ë°ì´í„° êµ¬ì¡°, í•¨ìˆ˜ ì„ ì–¸**ì„ ëª¨ë‘ ëª¨ì•„ë‘” â€œì •ì˜ì„œ(ë§¤ë‰´ì–¼)â€ ì…ë‹ˆë‹¤.
    
- `.c` íŒŒì¼ì€ ì´ ì •ì˜ë¥¼ ì‹¤ì œë¡œ ì‚¬ìš©í•´ ë™ì‘ì„ êµ¬í˜„í•˜ê³ , ì´ `.h`ëŠ” ì‚¬ìš©ë²•ê³¼ ë©”ëª¨ë¦¬ êµ¬ì¡°, í†µì‹  ê·œì¹™ì„ ë¬¸ì„œí™”í•œ ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.
    
- íŠ¹íˆ MODBUS ë°©ì‹ MFC(ì§ˆëŸ‰ìœ ëŸ‰ ì»¨íŠ¸ë¡¤ëŸ¬) + íŒí”„ + ì†”ë ˆë…¸ì´ë“œ ì œì–´ í”„ë¡œê·¸ë¨ì—ì„œ ì“°ì´ëŠ” ìƒìˆ˜ë“¤ì´ ë‹¤ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    

---

ğŸ’¡ íŒ:  
ì œê°€ ì›í•˜ì‹œë©´ ì´ **í—¤ë”ì™€ .c íŒŒì¼ì´ ì„œë¡œ ì—°ê²°ë˜ëŠ” êµ¬ì¡°**ì™€ **MODBUS ë°ì´í„° ì†¡ìˆ˜ì‹  íë¦„**ì„ ê·¸ë¦¼ìœ¼ë¡œ ê·¸ë ¤ ì„¤ëª…ë“œë¦´ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.  
ê·¸ëŸ¬ë©´ ì¥ì¹˜ ì œì–´ ì½”ë“œ ì „ì²´ íë¦„ì´ í›¨ì”¬ ì§ê´€ì ìœ¼ë¡œ ì´í•´ë  ê±°ì˜ˆìš”.

ì›í•˜ì‹œë©´ ê·¸ë ‡ê²Œ ì§„í–‰í• ê¹Œìš”?

1. [https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/6cbfc816-4686-48c1-8c59-42ef5e5fed3c/ControlPumpMFC.c](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/72041696/6cbfc816-4686-48c1-8c59-42ef5e5fed3c/ControlPumpMFC.c)