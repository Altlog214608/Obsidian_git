좋아요.  
지금 올려주신 두 번째 파일은 전형적인 **헤더 파일(.h)** 이고,  
첫 번째로 주신 C 파일(`ControlPumpMFC.c`)에서 실제 동작을 구현하기 위해 포함되는 정의(define), 구조체, 변수, 함수 원형(프로토타입)들이 들어있습니다.

아래에서 **코드 블록별로 쉽게 풀어서** 설명드릴게요.

---

## 1. 헤더 가드



```c
#ifndef _MFC #define _MFC ... #endif
```

- 이 부분은 **헤더 가드(Header Guard)** 입니다.
    
- 같은 헤더 파일이 여러 번 포함(include)되어도 중복 정의 오류가 나지 않게 합니다.
    
- `_MFC`가 아직 정의되지 않은 상태면 안의 내용을 읽고, 이미 정의됐다면 안의 내용을 무시합니다.
    

---

## 2. 명령어(Command) 정의


```c
#define CMD_RUN   1 #define CMD_CLEAN 2 #define CMD_STOP  3 #define CMD_RUNCL 4   // run & clean #define CMD_CLEAR 5   // duty clear ???
```


- 펌프나 밸브 제어를 위한 **명령 코드** 상수입니다.
    
- 장치에 MODBUS 같은 통신 프로토콜로 보내는 명령의 “값"을 상징적으로 사용.
    
    - `CMD_RUN` = 운전 시작
        
    - `CMD_CLEAN` = 클리닝 동작
        
    - `CMD_STOP` = 정지
        
    - `CMD_RUNCL` = 운전 후 바로 클리닝
        
    - `CMD_CLEAR` = 밸브 상태/데이터 초기화(추정)
        

---

## 3. 장치 ID
```c
#define MFC_MID 0x01 // main board ID
```

- MFC 장치의 메인보드 식별 ID.
    
- MODBUS 통신에서 슬레이브 장치 아이디로 0x01 사용.
    

---

## 4. 레지스터 주소 정의

이 부분이 핵심입니다.

## 4.1 읽기 전용 Input Register
```c
#define MFC_FVM 0x0FA0 // firmware version Main Board #define MFC_FVS 0x0FA2 // firmware version Sol Board #define MFC_PID 0x0FA4 // product info ... #define MFC_EMS 0x0FBC // EMS status (0=normal, 1=EMS) #define MFC_NSB 0x0FBD // number of Sol boards #define MFC_TMP 0x0FBE // temperature (*10) #define MFC_CGP 0x0FBF // gas pressure (*10) #define MFC_RST 0x0FC5 // run status #define MFC_SBS 0x0FC8 // sol board status #define MFC_SPS 0x0FDC // sol port status
```


- 장치 내부 값들을 읽기 위한 **MODBUS Input Register** 주소입니다.
    
- 예: `MFC_FVM`에 접근하면 메인보드 펌웨어 버전 값을 읽을 수 있습니다.
    
- 온도, 압력, 동작 상태, 보드 개수 등 장치 상태 정보를 읽어오는 데 사용.
    

---

## 4.2 읽기/쓰기 가능 Holding Register
```c
#define MFC_CMD 0x1068 // 명령 레지스터 
#define MFC_RPW 0x106A // run pump power % 
#define MFC_CPW 0x106B // clean pump power % 
#define MFC_POT 0x106C // run pump on time 
#define MFC_COT 0x106D // clean pump on time 
#define MFC_RPD 0x106E // run post delay 
#define MFC_CPD 0x106F // clean post delay 
#define MFC_PPF 0x1074 // 
pump PWM frequency #define MFC_VPF 0x1075 // valve PWM frequency 
#define MFC_SPA 0x1086 // 첫 번째 솔레노이드 보드 포트 duty 값 시작 주소
```

- 여기로 값을 쓰면 장치 동작이 바뀝니다.
    
- 예: `MFC_CMD`에 `CMD_RUN(1)`을 쓰면 실제 운전 모드로 장치가 작동.
    
- PWM 주파수, 동작 시간, 지연 시간 등 출력 동작 파라미터를 변경 가능.
    
- `MFC_SPA`는 밸브들의 개별 Duty(% 출력 비율) 값을 설정하는 시작 주소.
    

---

## 5. 구조체 `S_MFC`
```c
typedef struct {     
int tnsbd;         // 총 솔레노이드 보드 수    
int tnmfl;         // 총 멀티 플로우 라인 수    
double sumduty;    // 전체 duty 합계    
unsigned short *duty;     // 각 밸브 duty 값 저장    
unsigned short *status;   // 각 밸브 상태 값 저장    
int *lhindex;              // UI 제어용 인덱스 (uir 파일의 control ID와 연결)    
int cmdid, power, freq, runtime;    
double fscale, offset, coeff[6], *dutyzero;   
} 
S_MFC; 
S_MFC s_mfc;
```

- 프로그램 전체에서 사용할 **장치 상태/설정값 저장 구조체**.
    
- 특히 `fscale`, `offset`, `coeff[]`는 duty 값을 물리적으로 변환하는 보정 계수.
    
- `dutyzero[]`는 해당 채널이 동작하지 않을 때 기준 Duty 값.
    

---

## 6. 전역 변수
```c
int control_handle, acq_handle, file_handle, flag_chart; 
int flag_cpower, flag_ctime, flag_cfreq; 
unsigned char modbus_cmd, wait_bytes; 
char proj_dir[MAX_PATHNAME_LEN];
```

- LabWindows/CVI UI 핸들(`control_handle`, `acq_handle`) 저장.
    
- 통신 패킷 관련 상태 변수(`modbus_cmd`, `wait_bytes`).
    
- 실행 경로(`proj_dir`) 저장.
    

---

## 7. 함수 원형(프로토타입)
```c
void InitProcess(void); 
void QuitProcess(void); 
void DecodePacket(void); 
int DecodeData_MFC(unsigned short add, unsigned short qtres); 
int InitProcess_MFC(void);
void InitConfig_MFC(void); 
void ReadConfigProVal_MFC(void); 
void SetDutyBoard_MFC(int sbdindex); 
void ReadDutyBoard_MFC(int sbdindex); 
void WriteSingleReg_MFC(unsigned short add, unsigned short value); 
void WriteMultiReg_MFC(unsigned short add, unsigned short cmdvalue);  
void ReadRegister_MFC(unsigned char readcmd,unsigned short add, unsigned short rdreg); 
void Error_MFC(int errindex);
```


- 장치 초기화, 설정 읽기/쓰기, duty 제어, 에러 처리 등에 쓰이는 함수들의 선언부.
    
- 실제 구현은 오리지널 `.c` 파일(`ControlPumpMFC.c`) 안에 있습니다.
    

---

## 요약

- 이 헤더 파일은 **장치 제어를 위한 명령, 레지스터 주소, 데이터 구조, 함수 선언**을 모두 모아둔 “정의서(매뉴얼)” 입니다.
    
- `.c` 파일은 이 정의를 실제로 사용해 동작을 구현하고, 이 `.h`는 사용법과 메모리 구조, 통신 규칙을 문서화한 것과 같습니다.
    
- 특히 MODBUS 방식 MFC(질량유량 컨트롤러) + 펌프 + 솔레노이드 제어 프로그램에서 쓰이는 상수들이 다 정의되어 있습니다.
    

---

