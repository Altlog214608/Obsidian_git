ì¢‹ì•„â€”ëª©í‘œëŠ” â€œMy Own Perfume â†’ (ë²„íŠ¼ ì„ íƒ) â†’ Get Recommendation í´ë¦­â€ ì‹œ **QR ì½”ë“œì— ëª¨ë°”ì¼ ê²°ê³¼ URL**ì„ ê½‚ì•„ ë„£ëŠ” ê±°ì§€?  
ì§€ê¸ˆì€ QRì´ `idx`ë§Œ ë‹´ê¸´ GitHub Pages ì£¼ì†Œë¥¼ ì“°ê³  ìˆìœ¼ë‹ˆ, **(1) QR ìœ í‹¸(dsQRcode.py)ì„ â€˜íŒŒë¼ë¯¸í„°í˜•â€™ìœ¼ë¡œ ë°”ê¾¸ê³ **, **(2) FrSmart.pyì—ì„œ ì„ íƒê°’ì„ ëª¨ì•„ URL ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ ë„˜ê¸°ë©´** ëë‚˜.

ì•„ë˜ ê·¸ëŒ€ë¡œ ì ìš©í•˜ë©´ ë¼. (ì¤„ë²ˆí˜¸ëŠ” ì°¸ê³ ìš©)

---

# 1) `dsQRcode.py` ìˆ˜ì •: â€œíŒŒë¼ë¯¸í„° â†’ URL â†’ QRâ€ ì§€ì›

í˜„ì¬ëŠ” ì´ë ‡ê²Œ `idx`ë§Œ ë°›ëŠ” êµ¬ì¡°ì•¼.  
ì´ê±¸ **`params` ë”•ì…”ë„ˆë¦¬ë¥¼ ë°›ë„ë¡** ë°”ê¿”.

```python
# dsQRcode.py

import qrcode
import random
from urllib.parse import urlencode

# ê¸°ì¡´ ì „ì—­ base_urlì€ ë³´ê´€(ë ˆê±°ì‹œ)
LEGACY_BASE_URL = "https://hashswim.github.io/perfume_mobile_page/"

# âœ… ìƒˆ ê¸°ë³¸ URL (ëª¨ë°”ì¼ ê²°ê³¼ í˜ì´ì§€)
DEFAULT_RESULT_URL = "https://perfume-mobile.vercel.app/result"

def generate_qr_code(idx=None, save_path=None, *, base_url=DEFAULT_RESULT_URL, params=None):
    """
    paramsê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì¿¼ë¦¬ë¡œ ì¸ì½”ë”©í•˜ì—¬ QR ìƒì„±.
    paramsê°€ ì—†ìœ¼ë©´ (ë ˆê±°ì‹œ) idx ê¸°ë°˜ URL ì‚¬ìš©.
    """
    if params and isinstance(params, dict):
        # ë¹ˆ ê°’ì€ ì œê±°
        cleaned = {k: v for k, v in params.items() if v not in (None, "", -1)}
        full_url = f"{base_url}?{urlencode(cleaned)}"
    else:
        # ë ˆê±°ì‹œ ë™ì‘ ìœ ì§€: idx ì‚¬ìš©
        if idx is None:
            idx = random.randint(0, 11)
        full_url = f"{LEGACY_BASE_URL}?{urlencode({'idx': idx})}"

    # QR ìƒì„±
    qr = qrcode.QRCode(
        version=1,
        error_correction=qrcode.constants.ERROR_CORRECT_L,
        box_size=10,
        border=4,
    )
    qr.add_data(full_url)
    qr.make(fit=True)
    img = qr.make_image(fill_color="black", back_color="white")

    if save_path is None:
        # íŒŒì¼ëª…: perfume_qr_<timestamp or perfume>.png ë“±, í•„ìš”ì‹œ ë³€ê²½
        save_path = "qrcode.png"

    img.save(save_path)
    print(f"[QR] {full_url} -> saved: {save_path}")
    return save_path
```

> ìš”ì : `generate_qr_code(..., params={...})`ë¡œ í˜¸ì¶œí•˜ë©´ `DEFAULT_RESULT_URL` ë’¤ì— **ì„ íƒ íŒŒë¼ë¯¸í„°ë“¤ì´ ê·¸ëŒ€ë¡œ ?a=1&b=2**ë¡œ ë¶™ëŠ”ë‹¤.

---

# 2) `FrSmart.py` ìˆ˜ì •: ì„ íƒê°’ â†’ URL íŒŒë¼ë¯¸í„° êµ¬ì„± â†’ QR ìƒì„± í˜¸ì¶œ

ì¶”ì²œì´ ëë‚œ ë’¤ QRì„ ë§Œë“¤ê³  ìˆëŠ” ê³³ì´ ì—¬ê¸°ì•¼. í˜„ì¬ëŠ” `idx=number-1`ë§Œ ë„˜ê¸°ê³  ìˆì–´.  
ì´ ë¶€ë¶„ì„ **ì„ íƒê°’ì„ ëª¨ì•„ paramsë¡œ ë„˜ê¸°ë„ë¡** ë°”ê¿”.

ì•„ë˜ì²˜ëŸ¼ `setUiFindExpDlg()` ì•ˆì˜ QR ìƒì„± ë¶€ë¶„ë§Œ êµì²´í•˜ë©´ ëœë‹¤.

```python
# FrSmart.py

def setUiFindExpDlg(self, number):
    # ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì • (ê·¸ëŒ€ë¡œ)
    self.ui_find_exp_dlg.label_background.setStyleSheet(
        dsImage.dsFindDetailImg[number])

    # âœ… URL íŒŒë¼ë¯¸í„° êµ¬ì„±
    try:
        # MBTI ë¬¸ìì—´ë¡œ ë³€í™˜(ì„ íƒ personality â†’ MBTI)
        mbti_str = self._convert_personality_to_mbti(getattr(self, 'find_per_range_num', 0))

        # ì„ íƒê°’ ìˆ˜ì§‘: (ì—†ìœ¼ë©´ 0ìœ¼ë¡œ)
        def nz(x): 
            return int(x) if isinstance(x, (int, float)) else int(x) if str(x).isdigit() else 0

        params = {
            "perfume": number,                                  # 1~12 (ì¶”ì²œ ê²°ê³¼)
            "gender_id": nz(getattr(self, 'find_gender_range_num', 0)),
            "age_id": nz(getattr(self, 'find_age_range_num', 0)),
            "mbti": mbti_str if mbti_str != 'NONE' else "",     # ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´
            "fashion_id": nz(getattr(self, 'find_fashion_range_num', 0)),
            "pref_color_id": nz(getattr(self, 'find_color_range_num', 0)),
            "purpose_id": nz(getattr(self, 'find_purpose_range_num', 0)),
            "category_id": nz(getattr(self, 'find_category_range_num', 0)),

            # ë…¸íŠ¸ ë¹„ìœ¨(ì›í•˜ë©´ ëœë¤/ëª¨ë¸ê°’ìœ¼ë¡œ êµì²´ ê°€ëŠ¥)
            "top": 30, "middle": 40, "base": 30,
            "lang": "en",
        }

        # âœ… QR ìƒì„± (ëª¨ë°”ì¼ ê²°ê³¼ URLë¡œ ê³ ì •)
        qr_path = dsQRcode.generate_qr_code(
            save_path=f"temp_qr_{number}.png",
            base_url="https://perfume-mobile.vercel.app/result",
            params=params,
        )

        # QR ë¼ë²¨ ë°°ì¹˜ (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
        if not hasattr(self, 'qr_label'):
            self.qr_label = QtWidgets.QLabel(self.ui_find_exp_dlg)
            self.qr_label.setFixedSize(100, 100)
            self.qr_label.setStyleSheet("border: none; background: transparent;")

        qr_pixmap = QtGui.QPixmap(qr_path)
        self.qr_label.setPixmap(qr_pixmap.scaled(100, 100, Qt.AspectRatioMode.KeepAspectRatio))
        self.qr_label.move(self.ui_find_exp_dlg.width() - 120, 20)
        self.qr_label.show()

    except Exception as e:
        print(f"QR ì½”ë“œ ìƒì„± ì˜¤ë¥˜: {e}")
        if hasattr(self, 'qr_label'):
            self.qr_label.hide()
```

> ì°¸ê³ : ì¶”ì²œ ê²°ê³¼ `number`ëŠ” `find_recommend()`ì—ì„œ `predicted_id + 1`ë¡œ ì„¸íŒ…ë¨. ê·¸ë˜ì„œ ê·¸ëŒ€ë¡œ `perfume`ë¡œ ì“°ë©´ ë¼.

---

## ì„ íƒ: top/middle/baseë¥¼ ëœë¤ìœ¼ë¡œ ì£¼ê³  ì‹¶ë‹¤ë©´

ìœ„ `params`ì—ì„œ ì„¸ ì¤„ë§Œ ì´ë ‡ê²Œ ë°”ê¿”:

```python
import random
...
"top": random.randint(10, 60),
"middle": random.randint(20, 70),
"base": random.randint(10, 60),
```

(í•©ê³„ 100ì„ ê°•ì œí•˜ê³  ì‹¶ìœ¼ë©´ ê°„ë‹¨ ë¶„í•  ë¡œì§ ë„£ì–´ì¤„ê²Œ.)

---

## ë²„íŠ¼ ê°’ ë§¤í•‘ ì£¼ì˜ì 

- **Age**: í˜„ì¬ UIì—ì„œ 10s~~50+ë§Œ ìˆì–´ ê°’ì€ 1~~5ì•¼(60s=6ì€ UIì— ì—†ìŒ). ë‚˜ì¤‘ì— ë²„íŠ¼ ì¶”ê°€í•´ë„ ê·¸ëŒ€ë¡œ ì „ì†¡ë¨. ë²„íŠ¼ ìƒì„±ê°’ì€ ì´ ë¶€ë¶„ ì°¸ê³ .
    
- **Gender**: 1=Man, 2=Woman.
    
- **Personality â†’ MBTI**: URLì—ëŠ” `mbti=...`ë¡œ ë¬¸ìì—´ì„ ë³´ëƒ„(ENFP ë“±). ë³€í™˜ì€ ë‚´ë¶€ í•¨ìˆ˜ ì‚¬ìš©.
    
- **Purpose / Fashion / Prefer Color / Category**: ê° ë²„íŠ¼ì˜ ì„ íƒê°’ì´ `self.find_*_range_num`ì— ì €ì¥ë˜ê³ , ê·¸ëŒ€ë¡œ IDë¡œ ì‹¤ì–´ ë³´ëƒ„(ì—†ìœ¼ë©´ 0). ê° on_* í•¸ë“¤ëŸ¬ì—ì„œ ê°’ì´ ì„¤ì •ë¨. ì˜ˆ: colorëŠ” ì—¬ê¸°ì„œ ì…‹íŒ….
    

---

## ê²°ê³¼

ì´ì œ â€œMy Own Perfumeâ€ì—ì„œ ì˜µì…˜ ê³ ë¥´ê³  **Get Recommendation**ì„ ëˆ„ë¥´ë©´,  
ì¶”ì²œ í™”ë©´ ìš°ìƒë‹¨ QRì´ **ì˜ˆì‹œì™€ ê°™ì€ í˜•ì‹**ìœ¼ë¡œ ì°í˜€:

```
https://perfume-mobile.vercel.app/result
 ?perfume=8
 &gender_id=2
 &age_id=5
 &mbti=ENFP
 &fashion_id=5
 &pref_color_id=3
 &purpose_id=4
 &category_id=11
 &top=30&middle=40&base=30
 &lang=en
```

í•„ìš”í•˜ë©´ `base_url`ë§Œ í•œ ì¤„ë¡œ ë°”ê¿”ì„œ ë‹¤ë¥¸ ë°°í¬ ì£¼ì†Œ(ì˜ˆ: vercel preview)ë„ ë°”ë¡œ ì—°ê²° ê°€ëŠ¥.


ìš” ì•½

- **QR URL ìì²´ëŠ” ì˜ ìƒì„±**ëì–´ìš”. `perfume, gender_id, age_id, mbti, fashion_id, pref_color_id, purpose_id, top/middle/base, lang` ëª¨ë‘ URLì— í¬í•¨ë¼ ìˆê³  ê°’ë„ ì˜ë„ëŒ€ë¡œì…ë‹ˆë‹¤.
    
- ë‹¤ë§Œ **SW ë¡œê·¸ì˜ â€œì‚¬ëŒì´ ì½ëŠ” í…ìŠ¤íŠ¸ ìš”ì•½â€**ì—ì„œ ë‘ êµ°ë°ë§Œ ì–´ê¸‹ë‚˜ìš”:
    
    1. `Scent selected: 10`ì¸ë° URLì˜ `category_id=0` â†’ ì¹´í…Œê³ ë¦¬ idë¥¼ **0ì´ ì•„ë‹Œ 10**ìœ¼ë¡œ ë„£ì–´ì•¼ ì¼ì¹˜í•©ë‹ˆë‹¤.
        
    2. `Color selected: 8`ì¸ë° `Preferred_Color: None` â†’ ìƒ‰ìƒ í…ìŠ¤íŠ¸ ë³€í™˜ì— **ì˜ëª»ëœ í•¨ìˆ˜**ë¥¼ ì“°ê³  ìˆì–´ìš”. `convert_pref_to_text(8) â†’ 'Red'`ê°€ ë§ìŠµë‹ˆë‹¤.
        

ì•„ë˜ 3ì¤„ë§Œ ê³ ì¹˜ë©´ URLÂ·ë¡œê·¸Â·ëª¨ë°”ì¼ í˜ì´ì§€ê°€ ëª¨ë‘ ë™ì¼í•˜ê²Œ ë§ì¶°ì§‘ë‹ˆë‹¤.

---

## 1) QR íŒŒë¼ë¯¸í„° ì¡°ë¦½ì—ì„œ category_id ì˜¬ë°”ë¥¸ ê°’ ë„£ê¸°

ì§€ê¸ˆì€ `category_id`ì— `find_category_range_num`(í˜¹ì€ ê¸°ë³¸ 0)ì´ ë“¤ì–´ê°€ ë¡œê·¸ì™€ ì•ˆ ë§ìŠµë‹ˆë‹¤.  
UI ë¡œê·¸ì— ì°íŒ `Scent selected: 10`ì´ ì‹¤ì œ ì„ íƒê°’ì´ë¼ë©´ ê·¸ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”(ì´ë¦„ì€ ì˜ˆì‹œ).

```python
# FrSmart.py â€“ QR params ì¡°ë¦½í•˜ëŠ” ê³³ (setUiFindExpDlg ë‚´ë¶€)
params = {
    "perfume": number,
    "gender_id": nz(getattr(self, 'find_gender_range_num', 0)),
    "age_id": nz(getattr(self, 'find_age_range_num', 0)),
    "mbti": mbti_str if mbti_str != 'NONE' else "",
    "fashion_id": nz(getattr(self, 'find_fashion_range_num', 0)),
    "pref_color_id": nz(getattr(self, 'find_color_range_num', 0)),
    "purpose_id": nz(getattr(self, 'find_purpose_range_num', 0)),

    # ğŸ”§ ì—¬ê¸°! Scent(=ì¹´í…Œê³ ë¦¬) ì„ íƒê°’ì„ ì‹¤ì œë¡œ ì“°ê¸°
    # ê¸°ì¡´: "category_id": nz(getattr(self, 'find_category_range_num', 0)),
    "category_id": nz(getattr(self, 'find_scent_range_num', getattr(self, 'find_category_range_num', 0))),

    "top": 30, "middle": 40, "base": 30,
    "lang": "en",
}
```

> ë§Œì•½ ë„¤ ì½”ë“œì—ì„œ â€œScentâ€ê°€ ê³§ â€œCategoryâ€ë¼ë©´, ìœ„ì²˜ëŸ¼ `find_scent_range_num`ì„ ìš°ì„  ì“°ê³ , ì—†ìœ¼ë©´ `find_category_range_num`ìœ¼ë¡œ í´ë°±í•˜ë©´ ë©ë‹ˆë‹¤.

---

## 2) ë¡œê·¸(ì‚¬ëŒ ì½ëŠ” í…ìŠ¤íŠ¸)ì—ì„œ ìƒ‰ìƒ í…ìŠ¤íŠ¸ í•¨ìˆ˜ êµì²´

ì§€ê¸ˆì€ ì•„ë§ˆ `self._convert_color_to_text(color)`ë¥¼ ì¨ì„œ 8ì´ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ **None**ì´ ë‚˜ì˜µë‹ˆë‹¤.  
ìƒ‰ìƒì€ 1~14 ë§¤í•‘ì¸ **`_convert_pref_to_text`**ê°€ ë§ìŠµë‹ˆë‹¤.

```python
# ì˜ˆ: ì‚¬ëŒì´ ì½ëŠ” ìš”ì•½ dict ë§Œë“¤ ë•Œ
color_id = nz(getattr(self, 'find_color_range_num', 0))
preferred_color_text = self._convert_pref_to_text(color_id)  # âœ… ì´ê²Œ ë§ìŒ (1~14)
# ê¸°ì¡´ì— _convert_color_to_text(...)ë¥¼ ì“°ê³  ìˆì—ˆë‹¤ë©´ ì´ ì¤„ë¡œ êµì²´

summary = {
    'Age': self._convert_age_to_number(nz(getattr(self, 'find_age_range_num', 0))),
    'Gender': self._convert_gender_to_text(nz(getattr(self, 'find_gender_range_num', 0))),
    'Personality': self._convert_personality_to_text(nz(getattr(self, 'find_per_range_num', 0))),
    'Purpose': self._convert_purpose_to_text(nz(getattr(self, 'find_purpose_range_num', 0))),
    'Preferred_Scent': self._convert_category_to_text(nz(getattr(self, 'find_scent_range_num', 0))),  # ì„ íƒ
    'Preferred_Color': preferred_color_text,  # âœ… ì—¬ê¸° êµì²´
    'Fashion': self._convert_fashion_to_text(nz(getattr(self, 'find_fashion_range_num', 0))),
    'Category': self._convert_category_to_text(nz(getattr(self, 'find_category_range_num', 0))),
}
```

> ì°¸ê³ : ë„ˆê°€ ì˜¬ë¦° ë§¤í•‘ì—ì„œ
> 
> - `convert_pref_to_text`: ìƒ‰ìƒ(1~14) â†’ `"Red"`, `"Mint"` â€¦
>     
> - `convert_color_to_text`: ë‹¤ë¥¸ íŒ”ë ˆíŠ¸(1~7) â†’ `"Red"`, `"Navy"` â€¦ ì´ë¼ id ë²”ìœ„ê°€ ë‹¬ë¼ìš”.
>     

---

## 3) (ì„ íƒ) URLì— ì„ í˜¸í–¥(pref_scent)ë„ ì‹£ê³  ì‹¶ë‹¤ë©´

UIì— â€œPreferred Scent(ì„ í˜¸ í–¥)â€ ë²„íŠ¼ì´ ë”°ë¡œ ìˆë‹¤ë©´, URLì—ë„ ë„£ê³  ëª¨ë°”ì¼ì—ì„œ í™œìš©í•  ìˆ˜ ìˆì–´ìš”.

```python
params["pref_scent"] = nz(getattr(self, 'find_scent_range_num', 0))
```

ëª¨ë°”ì¼ ìª½(`parseQuery`)ì€ ì´ë¯¸ `pref_scent`ë¥¼ ë°›ì„ ì¤€ë¹„ê°€ ë¼ ìˆìœ¼ë‹ˆ ê·¸ëŒ€ë¡œ ì“°ë©´ ë©ë‹ˆë‹¤.

---

## ì§€ê¸ˆ ê²°ê³¼ì— ëŒ€í•œ íŒë‹¨

- URL: `â€¦perfume=11&gender_id=1&age_id=3&mbti=ISFP&fashion_id=3&pref_color_id=8&purpose_id=3&category_id=0â€¦`  
    â†’ **ê±°ì˜ OK**. `category_id`ë§Œ 10ìœ¼ë¡œ ë°”ë€Œë©´ ì™„ë²½.
    
- SW ë¡œê·¸:
    
    - `Age selected: 3` â†’ 30ëŒ€, dict: `Age: 35` âœ… (ë„¤ ë§¤í•‘ì´ 30sâ†’35ë¡œ ëŒ€í‘œê°’í™”)
        
    - `Gender selected: 1` â†’ `Man` âœ…
        
    - `Personality selected: 3` â†’ `Neuroticism`, MBTI=ISFP âœ… (ë„¤ ë§¤í•‘ëŒ€ë¡œ)
        
    - `Purpose selected: 3` â†’ `Unique Style` âœ…
        
    - `Fashion Style selected: 3` â†’ `Classic` âœ…
        
    - `Color selected: 8` â†’ **Preferred_Color: None** âŒ (ìœ„ 2ë²ˆ íŒ¨ì¹˜ë¡œ í•´ê²°)
        
    - `Scent selected: 10` â†’ **Category: None / URL category_id=0** âŒ (ìœ„ 1ë²ˆ íŒ¨ì¹˜ë¡œ í•´ê²°)
        

ìœ„ ë‘ êµ°ë°ë§Œ ê³ ì¹˜ë©´ **URLÂ·ë¡œê·¸Â·ëª¨ë°”ì¼ í™”ë©´ì´ ëª¨ë‘ ë”± ë§ê²Œ** ë™ì‘í•©ë‹ˆë‹¤.  
íŒ¨ì¹˜ ë„£ê³  ë‹¤ì‹œ í•œë²ˆ QR ì°ì–´ë³´ë©´, ì˜ˆ:  
`â€¦&category_id=10&pref_color_id=8â€¦` â†’ ëª¨ë°”ì¼ì—ì„œ `"ì¹´í…Œê³ ë¦¬: Musk"` / `"ì„ í˜¸ ìƒ‰ìƒ: Red"`ë¡œ ë‚˜ì˜¬ ê±°ì˜ˆìš”.


ë§ì•„ìš”â€”**2ë²ˆ(ìƒ‰ìƒ í…ìŠ¤íŠ¸ í•¨ìˆ˜ êµì²´)**ëŠ” ì—¬ê¸°ì˜ˆìš”.

- íŒŒì¼: `FrSmart.py`
    
- ìœ„ì¹˜: `find_recommend(...)` ì•ˆì—ì„œ `deepfm_input_data` ë§Œë“œëŠ” ë¶€ë¶„  
    ì§€ê¸ˆì€ ì´ë ‡ê²Œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤ (ìƒ‰ìƒì´ 1~7 ì „ìš© ë§µì„ ì¨ì„œ 8 ê°™ì€ ê°’ì´ ë“¤ì–´ì˜¤ë©´ `None`ì´ ë‚˜ì™€ìš”):  
    `'Preferred_Color': self._convert_color_to_text(color),`
    

### ê³ ì¹˜ëŠ” í•œ ì¤„

```python
# before
'Preferred_Color': self._convert_color_to_text(color),
# after
'Preferred_Color': self._convert_pref_to_text(color),
```

ì´ë ‡ê²Œ ë°”ê¾¸ë©´ 1~~14 ë²”ìœ„ì˜ â€œì„ í˜¸ìƒ‰â€ ë§µì„ ì¨ì„œ `8 â†’ 'Red'` ê°™ì´ ì œëŒ€ë¡œ ì°í™ë‹ˆë‹¤. í•´ë‹¹ ë§µì€ ì•„ë˜ì²˜ëŸ¼ ì •ì˜ë˜ì–´ ìˆì–´ìš”(0~~14):

ìˆ˜ì • í›„ì—ëŠ” `print(deepfm_input_data)` ë¡œê·¸ì—ì„œ `Preferred_Color`ê°€ `None`ì´ ì•„ë‹ˆë¼ ì‹¤ì œ ìƒ‰ìƒëª…ìœ¼ë¡œ ë‚˜ì˜µë‹ˆë‹¤.

> ì¶”ê°€ íŒ: í˜¹ì‹œ íŒŒì¼ ì•ˆì— `'_convert_color_to_text('`ì„ ì“°ëŠ” ë‹¤ë¥¸ ìš”ì•½/ë¡œê·¸ êµ¬ê°„ì´ ìˆìœ¼ë©´ ë™ì¼í•˜ê²Œ `'_convert_pref_to_text('`ë¡œ êµì²´í•´ ì£¼ì„¸ìš”.
> 
> 
> 



ì¢‹ì€ í¬ì°©ì´ì•¼. ì§€ê¸ˆ ê²°ê³¼ê°€ â€œì„±ë³„: Unspecified / ë‚˜ì´: 20s / ìƒ‰ìƒ: Blueâ€ë¡œ ì—‡ë‚˜ê°„ ì´ìœ ëŠ” ë”± 2ê°€ì§€ì•¼.

---

## 1) `gender`/`age`ì˜ â€œë¬¸ìì—´ ê¸°ë³¸ê°’â€ì´ ìˆ«ì IDë¥¼ ë®ì–´ì”€ (ì›¹)

- `parseQuery`ê°€ ì¿¼ë¦¬ì— `gender_id`/`age_id`ë§Œ ì™€ë„, ë¬¸ìì—´ ê¸°ë³¸ê°’ì„ ê°•ì œë¡œ ë„£ê³  ìˆì–´.
    
    - `gender: sp.get("gender") ?? "unspecified"`
        
    - `age: sp.get("age") ?? "20s"`
        
- `PerfumeResult.jsx`ëŠ” **ë¬¸ìì—´ ê°’ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ë¨¼ì € ì‚¬ìš©**í•˜ê¸° ë•Œë¬¸ì—, IDë¡œ ë³´ë‚¸ ê°’ì´ ìˆì–´ë„ â€œUnspecified / 20sâ€ê°€ ì°í˜€ë²„ë¦° ê±°ì•¼.
    

### ê³ ì¹˜ëŠ” ë²• (ë‘˜ ì¤‘ í•˜ë‚˜ë©´ ì¶©ë¶„, ë‘˜ ë‹¤ í•˜ë©´ ë” ì•ˆì „)

**A. `query.js` ìˆ˜ì • (ê¶Œì¥)**

```diff
// src/lib/query.js
- gender: sp.get("gender") ?? "unspecified",
- age: sp.get("age") ?? "20s",
+ gender: sp.get("gender") || null,   // ë¬¸ìì—´ ì¿¼ë¦¬ê°€ ì—†ìœ¼ë©´ null
+ age: sp.get("age") || null,
```

**B. `PerfumeResult.jsx`ì—ì„œ â€œID ìš°ì„ , ë¬¸ìì—´ í›„ìˆœìœ„â€ë¡œ ë³€ê²½**

```diff
// ì„±ë³„
- const vGender = (() => {
-   if (params.gender != null) return valueMaps.gender[params.gender] ?? params.gender;
-   const gid = Number(params.gender_id);
-   if (!Number.isNaN(gid)) return (lang === 'ko' ? GENDER_TEXT_KO : GENDER_TEXT_EN)[gid] ?? '';
-   return '';
- })();
+ const vGender = (() => {
+   const gid = Number(params.gender_id);
+   if (!Number.isNaN(gid) && gid !== 0) {
+     return (lang === 'ko' ? GENDER_TEXT_KO : GENDER_TEXT_EN)[gid] ?? '';
+   }
+   if (params.gender) return valueMaps.gender[params.gender] ?? params.gender;
+   return '';
+ })();

// ë‚˜ì´
- const vAge = (() => {
-   let grp = params.age;
-   if (!grp && params.age_id != null) grp = AGE_GROUP_FROM_ID[Number(params.age_id)];
-   return valueMaps.age[grp] ?? grp ?? '';
- })();
+ const vAge = (() => {
+   const aid = Number(params.age_id);
+   if (!Number.isNaN(aid) && aid !== 0) {
+     const grp = AGE_GROUP_FROM_ID[aid];
+     return valueMaps.age[grp] ?? grp ?? '';
+   }
+   const grp = params.age;
+   return valueMaps.age[grp] ?? grp ?? '';
+ })();
```

---

## 2) ìƒ‰ìƒ ì½”ë“œ ì²´ê³„ê°€ SW â†” ì›¹ ì„œë¡œ ë‹¬ë¼ì„œ ë§¤í•‘ í•„ìš” (SW)

- **SW(ë²„íŠ¼ ê°’)**: 1=Beige, 2=Black, 3=Blue, 4=Brown, 5=Coral, 6=Gray, 7=Green, 8=Mint, 9=Orange, 10=Pink
    
- **ì›¹(`pref_color_id`)**: 1=Blue, 2=Pink, 3=Coral, 4=Beige, 5=Brown, 6=Black, 7=Purple, 8=Red, 9=Yellow, 10=Orange, 11=Mint, 12=Green, 13=Gray, 14=White
    

ê·¸ë˜ì„œ ì˜ˆ: **Beige(ë²„íŠ¼ 1)** â†’ ì›¹ì—ì„œëŠ” **4**ê°€ ë§ëŠ”ë°, ì§€ê¸ˆì€ ê·¸ëŒ€ë¡œ 1ì„ ë³´ë‚´ì„œ Blueë¡œ ë³´ì¸ ê±°ì•¼.

### ê³ ì¹˜ëŠ” ë²•: `FrSmart.py`ì—ì„œ QR íŒŒë¼ë¯¸í„° ë§Œë“¤ ë•Œ ë§¤í•‘ ì¶”ê°€

1. í´ë˜ìŠ¤ ì•ˆì— í—¬í¼ ì¶”ê°€(ë‹¤ë¥¸ `_convert_...` í•¨ìˆ˜ë“¤ ê·¼ì²˜ì— ë‘ë©´ ì •ë¦¬ ì˜ ë¨):
    

```python
def _map_color_button_to_web_id(self, val):
    mapping = {
        1: 4,   # Beige -> 4
        2: 6,   # Black -> 6
        3: 1,   # Blue  -> 1
        4: 5,   # Brown -> 5
        5: 3,   # Coral -> 3
        6: 13,  # Gray  -> 13
        7: 12,  # Green -> 12
        8: 11,  # Mint  -> 11
        9: 10,  # Orange-> 10
        10: 2,  # Pink  -> 2
    }
    try:
        return mapping.get(int(val), 0)
    except Exception:
        return 0
```

2. `setUiFindExpDlg` ë‚´ `params` ë§Œë“¤ ë•Œ ì´ í•¨ìˆ˜ë¥¼ ì‚¬ìš©:
    

```diff
- "pref_color_id": nz(getattr(self, 'find_color_range_num', 0)),
+ "pref_color_id": self._map_color_button_to_web_id(getattr(self, 'find_color_range_num', 0)),
```

ì´ë ‡ê²Œ í•˜ë©´ SWì—ì„œ Beigeë¥¼ ëˆŒëŸ¬ë„ ì›¹ì—ì„œëŠ” ì •í™•íˆ Beigeë¡œ í‘œì‹œë¼.

---

## ì°¸ê³  (ì •ìƒ ë™ì‘ ì²´í¬)

- ìœ„ ë‘ ê°€ì§€ ë°˜ì˜ í›„, SWì—ì„œ QRì„ ë‹¤ì‹œ ìƒì„±í•´ì„œ ì—´ë©´:
    
    - `gender_id=1/2`ê°€ â€œë‚¨ì/ì—¬ì(Man/Woman)â€ë¡œ ë§ê²Œ ë³´ì´ê³ ,
        
    - `age_id=1`ì´ë©´ â€œ10ëŒ€(10s)â€ë¡œ í‘œì‹œ,
        
    - ìƒ‰ìƒë„ ë²„íŠ¼ ì„ íƒê³¼ ë™ì¼í•˜ê²Œ í‘œì‹œë¼.
        

MBTIê°€ ENFPë¡œ ë‚˜ì˜¤ëŠ” ê±´, **ì„±ê²© ì²« ë²ˆì§¸ ë²„íŠ¼ì„ ì„ íƒí•˜ë©´ ENFP**ë¡œ ë§¤í•‘í•˜ëŠ” í˜„ì¬ ê·œì¹™ì´ ë§ì•„ì„œ ì •ìƒì´ì•¼.

í•„ìš”í•˜ë©´ ë‚´ê°€ â€œë¬¸ìì—´ ê¸°ë³¸ê°’â€ì„ ì•„ì˜ˆ ì•ˆ ì£¼ë„ë¡ `query.js`ì˜ ë‹¤ë¥¸ í•­ëª©ë“¤(`purpose`, `category` ë“±)ë„ ê°™ì€ íŒ¨í„´ìœ¼ë¡œ ì •ë¦¬í•´ì¤„ê²Œ.