# DeepFM 데이터 변환 함수들

    def _convert_age_to_group(self, age):

        """나이 번호를 age_group으로 변환"""

        age_map = {

            0: 'NONE',      # FIND_AGE_NONE

            1: '10s',       # FIND_AGE_TEENS  

            2: '20s',       # FIND_AGE_TWENTIES

            3: '30s',       # FIND_AGE_THIRTIES

            4: '40s',       # FIND_AGE_FORTIES

            5: '50s',       # FIND_AGE_FIFTIES

            6: '50s'        # FIND_AGE_SIXTIES (50s로 매핑)

        }

        return age_map.get(age, 'NONE')

    def _convert_gender_to_deepfm(self, gender):

        """성별 번호를 DeepFM 형식으로 변환"""

        gender_map = {

            0: 'NONE',      # FIND_GENDER_NONE

            1: 'M',         # FIND_GENDER_MAN

            2: 'F'          # FIND_GENDER_WOMAN

        }

        return gender_map.get(gender, 'NONE')

    def _convert_personality_to_mbti(self, personality):

        """성격 번호를 MBTI로 변환"""

        mbti_map = {

            0: 'NONE',      # FIND_PER_NONE

            1: 'ENFP',      # FIND_PER_EXTRAVERSION

            2: 'INFP',      # FIND_PER_OPENNESS

            3: 'ISFP',      # FIND_PER_NEUROTICISM

            4: 'ISTJ',      # FIND_PER_DILIGENCE

            5: 'ISFJ'       # FIND_PER_AGREEABLENESS

        }

        return mbti_map.get(personality, 'NONE')

    def _convert_scent_to_purpose(self, pref_scent):

        """선호 향을 purpose로 변환"""

        purpose_map = {

            0: 'good_impression',   # FIND_PREF_NONE

            1: 'mood_boost',        # FIND_PREF_AROMATIC

            2: 'good_impression',   # FIND_PREF_CITRUS

            3: 'self_satisfaction', # FIND_PREF_WOODY

            4: 'date_or_social',    # FIND_PREF_FLORAL

            5: 'formal_occasion',   # FIND_PREF_SPICY

            6: 'special_event',     # FIND_PREF_CHYPRE

            7: 'unique_style',      # FIND_PREF_FOUGERE

            8: 'mood_boost',        # FIND_PREF_FRUITY

            9: 'self_satisfaction', # FIND_PREF_ANIMALIC

            10: 'formal_occasion',  # FIND_PREF_ORIENTAL

            11: 'special_event',    # FIND_PREF_AMBER

            12: 'unique_style'      # FIND_PREF_ALDEHYDE

        }

        return purpose_map.get(pref_scent, 'good_impression')

  

    def _convert_purpose_to_deepfm(self, purpose):

        """목적을 DeepFM 형식으로 변환"""

        purpose_map = {

            0: 'good_impression',   # FIND_PURPOSE_NONE

            1: 'mood_boost',        # FIND_PURPOSE_MOOD_BOOST

            2: 'good_impression',   # FIND_PURPOSE_GOOD_IMPRESSION

            3: 'unique_style',      # FIND_PURPOSE_UNIQUE_STYLE

            4: 'self_satisfaction', # FIND_PURPOSE_SELF_SATISFACTION

            5: 'date_or_social',    # FIND_PURPOSE_DATE_OR_SOCIAL

            6: 'formal_occasion',   # FIND_PURPOSE_FORMAL_OCCASION

            7: 'special_event'      # FIND_PURPOSE_SPECIAL_EVENT

        }

        return purpose_map.get(purpose, 'good_impression')

  

    def _convert_fashion_to_style(self, fashion):

        """패션 스타일을 fashionstyle로 변환"""

        style_map = {

            0: 'casual',            # FIND_FASHION_NONE

            1: 'casual',            # FIND_FASHION_CASUAL

            2: 'chic',              # FIND_FASHION_CHIC

            3: 'classic',           # FIND_FASHION_CLASSIC

            4: 'freestyle',         # FIND_FASHION_FREESTYLE

            5: 'lovely',            # FIND_FASHION_LOVELY

            6: 'minimal',           # FIND_FASHION_MINIMAL

            7: 'modern',            # FIND_FASHION_MODERN

            8: 'romantic',          # FIND_FASHION_ROMANTIC

            9: 'simple',            # FIND_FASHION_SIMPLE

            10: 'sports'            # FIND_FASHION_SPORTS

        }

        return style_map.get(fashion, 'casual')

  

    def _convert_age_to_number(self, age):

        """나이 번호를 실제 나이로 변환"""

        age_map = {

            0: 25,      # FIND_AGE_NONE

            1: 15,      # FIND_AGE_TEENS (10-19)

            2: 25,      # FIND_AGE_TWENTIES (20-29)

            3: 35,      # FIND_AGE_THIRTIES (30-39)

            4: 45,      # FIND_AGE_FORTIES (40-49)

            5: 55,      # FIND_AGE_FIFTIES (50+)

        }

        return age_map.get(age, 25)

    def _convert_gender_to_text(self, gender):

        """성별 번호를 텍스트로 변환"""

        gender_map = {

            0: 'None',      # FIND_GENDER_NONE

            1: 'Man',       # FIND_GENDER_MAN

            2: 'Woman'      # FIND_GENDER_WOMAN

        }

        return gender_map.get(gender, 'None')

    def _convert_personality_to_text(self, personality):

        """성격 번호를 텍스트로 변환"""

        personality_map = {

            0: 'None',          # FIND_PER_NONE

            1: 'Extraversion',  # FIND_PER_EXTRAVERSION

            2: 'Openness',      # FIND_PER_OPENNESS

            3: 'Neuroticism',   # FIND_PER_NEUROTICISM

            4: 'Diligence',     # FIND_PER_DILIGENCE

            5: 'Agreeableness'  # FIND_PER_AGREEABLENESS

        }

        return personality_map.get(personality, 'None')

    def _convert_purpose_to_text(self, purpose):

        """목적 번호를 텍스트로 변환"""

        purpose_map = {

            0: 'None',              # FIND_PURPOSE_NONE

            1: 'Mood Boost',        # FIND_PURPOSE_MOOD_BOOST

            2: 'Good Impression',   # FIND_PURPOSE_GOOD_IMPRESSION

            3: 'Unique Style',      # FIND_PURPOSE_UNIQUE_STYLE

            4: 'Self Satisfaction', # FIND_PURPOSE_SELF_SATISFACTION

            5: 'Date or Social',    # FIND_PURPOSE_DATE_OR_SOCIAL

            6: 'Formal Occasion',   # FIND_PURPOSE_FORMAL_OCCASION

            7: 'Special Event'      # FIND_PURPOSE_SPECIAL_EVENT

        }

        return purpose_map.get(purpose, 'None')

    def _convert_color_to_text(self, color):

        """색상 번호를 텍스트로 변환"""

        color_map = {

            0: 'None',      # FIND_COLOR_NONE

            1: 'Red',       # FIND_COLOR_RED

            2: 'Orange',    # FIND_COLOR_ORANGE

            3: 'Yellow',    # FIND_COLOR_YELLOW

            4: 'Green',     # FIND_COLOR_GREEN

            5: 'Blue',      # FIND_COLOR_BLUE

            6: 'Navy',      # FIND_COLOR_NAVY

            7: 'Purple'     # FIND_COLOR_PURPLE

        }

        return color_map.get(color, 'None')

    def _convert_pref_to_text(self, pref_scent):

        """선호 향 번호를 텍스트로 변환"""

        pref_map = {

            0: 'None',      # FIND_PREF_NONE

            1: 'Blue',      # FIND_PREF_BLUE

            2: 'Pink',      # FIND_PREF_PINK

            3: 'Coral',     # FIND_PREF_CORAL

            4: 'Beige',     # FIND_PREF_BEIGE

            5: 'Brown',     # FIND_PREF_BROWN

            6: 'Black',     # FIND_PREF_BLACK

            7: 'Purple',    # FIND_PREF_PURPLE

            8: 'Red',       # FIND_PREF_RED

            9: 'Yellow',    # FIND_PREF_YELLOW

            10: 'Orange',   # FIND_PREF_ORANGE

            11: 'Mint',     # FIND_PREF_MINT

            12: 'Green',    # FIND_PREF_GREEN

            13: 'Gray',     # FIND_PREF_GRAY

            14: 'White'     # FIND_PREF_WHITE

        }

        return pref_map.get(pref_scent, 'None')

  

    def _convert_category_to_text(self, category):

        """향수 카테고리 번호를 텍스트로 변환"""

        category_map = {

            0: 'None',           # FIND_CATEGORY_NONE

            1: 'Aquatic',        # FIND_CATEGORY_AQUATIC

            2: 'Aromatic',       # FIND_CATEGORY_AROMATIC

            3: 'Casual',         # FIND_CATEGORY_CASUAL

            4: 'Citrus',         # FIND_CATEGORY_CITRUS

            5: 'Floral',         # FIND_CATEGORY_FLORAL

            6: 'Fougère',        # FIND_CATEGORY_FOUGERE

            7: 'Fruity',         # FIND_CATEGORY_FRUITY

            8: 'Green',          # FIND_CATEGORY_GREEN

            9: 'Light Floral',   # FIND_CATEGORY_LIGHT_FLORAL

            10: 'Musk',          # FIND_CATEGORY_MUSK

            11: 'Spicy',         # FIND_CATEGORY_SPICY

            12: 'Woody'          # FIND_CATEGORY_WOODY

        }

        return category_map.get(category, 'None')

  

    def _convert_fashion_to_text(self, fashion):

        """패션 스타일 번호를 텍스트로 변환"""

        fashion_map = {

            0: 'None',          # FIND_FASHION_NONE

            1: 'Casual',        # FIND_FASHION_CASUAL

            2: 'Chic',          # FIND_FASHION_CHIC

            3: 'Classic',       # FIND_FASHION_CLASSIC

            4: 'Free Style',    # FIND_FASHION_FREESTYLE

            5: 'Lovely',        # FIND_FASHION_LOVELY

            6: 'Minimal',       # FIND_FASHION_MINIMAL

            7: 'Modern',        # FIND_FASHION_MODERN

            8: 'Romantic',      # FIND_FASHION_ROMANTIC

            9: 'Simple',        # FIND_FASHION_SIMPLE

            10: 'Sports'        # FIND_FASHION_SPORTS

        }

        return fashion_map.get(fashion, 'None')

  

    def _convert_color_to_deepfm(self, color):

        """색상 번호를 DeepFM 형식으로 변환"""

        color_map = {

            0: 'white',     # FIND_COLOR_NONE

            1: 'red',       # FIND_COLOR_RED

            2: 'orange',    # FIND_COLOR_ORANGE

            3: 'yellow',    # FIND_COLOR_YELLOW

            4: 'green',     # FIND_COLOR_GREEN

            5: 'blue',      # FIND_COLOR_BLUE

            6: 'blue',      # FIND_COLOR_NAVY (blue로 매핑)

            7: 'purple'     # FIND_COLOR_PURPLE

        }
        
        

---
정리본

// lookups.js (or inside your component file)

/** AGE */
export const AGE_GROUP = {
  0: "NONE", 1: "10s", 2: "20s", 3: "30s", 4: "40s", 5: "50s", 6: "50s", // 6→'50s'
};
export const AGE_NUMBER = {
  0: 25, 1: 15, 2: 25, 3: 35, 4: 45, 5: 55,
};

/** GENDER */
export const GENDER_DEEPFM = { 0: "NONE", 1: "M", 2: "F" };
export const GENDER_TEXT   = { 0: "None", 1: "Man", 2: "Woman" };

/** PERSONALITY */
export const PERSONALITY_MBTI = {
  0: "NONE", 1: "ENFP", 2: "INFP", 3: "ISFP", 4: "ISTJ", 5: "ISFJ",
};
export const PERSONALITY_TEXT = {
  0: "None", 1: "Extraversion", 2: "Openness", 3: "Neuroticism",
  4: "Diligence", 5: "Agreeableness",
};

/** PURPOSE */
export const PURPOSE_KEY = {
  0: "good_impression",
  1: "mood_boost",
  2: "good_impression",
  3: "unique_style",
  4: "self_satisfaction",
  5: "date_or_social",
  6: "formal_occasion",
  7: "special_event",
};
export const PURPOSE_TEXT = {
  0: "None",
  1: "Mood Boost",
  2: "Good Impression",
  3: "Unique Style",
  4: "Self Satisfaction",
  5: "Date or Social",
  6: "Formal Occasion",
  7: "Special Event",
};
// (옵션) 선호향 코드 → purpose 키 매핑도 필요하면 함께
export const PREF_SCENT_TO_PURPOSE = {
  0: "good_impression",   // NONE
  1: "mood_boost",        // AROMATIC
  2: "good_impression",   // CITRUS
  3: "self_satisfaction", // WOODY
  4: "date_or_social",    // FLORAL
  5: "formal_occasion",   // SPICY
  6: "special_event",     // CHYPRE
  7: "unique_style",      // FOUGERE
  8: "mood_boost",        // FRUITY
  9: "self_satisfaction", // ANIMALIC
  10: "formal_occasion",  // ORIENTAL
  11: "special_event",    // AMBER
  12: "unique_style",     // ALDEHYDE
};

/** FASHION STYLE */
export const FASHION_STYLE_KEY = {
  0: "casual", 1: "casual", 2: "chic", 3: "classic", 4: "freestyle",
  5: "lovely", 6: "minimal", 7: "modern", 8: "romantic", 9: "simple", 10: "sports",
};
export const FASHION_STYLE_TEXT = {
  0: "None", 1: "Casual", 2: "Chic", 3: "Classic", 4: "Free Style",
  5: "Lovely", 6: "Minimal", 7: "Modern", 8: "Romantic", 9: "Simple", 10: "Sports",
};

/** PREFER COLOR (선호 색상) */
export const PREFER_COLOR_TEXT = {
  0: "None", 1: "Blue", 2: "Pink", 3: "Coral", 4: "Beige", 5: "Brown",
  6: "Black", 7: "Purple", 8: "Red", 9: "Yellow", 10: "Orange",
  11: "Mint", 12: "Green", 13: "Gray", 14: "White",
};
// (참고) ‘기본 색상’ 코드가 따로 있다면:
export const COLOR_TEXT = {
  0: "None", 1: "Red", 2: "Orange", 3: "Yellow", 4: "Green", 5: "Blue", 6: "Navy", 7: "Purple",
};
export const COLOR_DEEPFM_KEY = {
  0: "white", 1: "red", 2: "orange", 3: "yellow", 4: "green", 5: "blue", 6: "blue", 7: "purple",
}; // Navy→blue 매핑

/** PERFUME CATEGORY */
export const CATEGORY_TEXT = {
  0: "None", 1: "Aquatic", 2: "Aromatic", 3: "Casual", 4: "Citrus",
  5: "Floral", 6: "Fougère", 7: "Fruity", 8: "Green",
  9: "Light Floral", 10: "Musk", 11: "Spicy", 12: "Woody",
};


// URL 쿼리 → 정수 코드라고 가정
const ageId = Number(params.age_id);
const ageGroup = AGE_GROUP[ageId];     // "20s"
const ageNum   = AGE_NUMBER[ageId];    // 25

const genderText = GENDER_TEXT[params.gender_id];     // "Man" / "Woman"
const genderDFM  = GENDER_DEEPFM[params.gender_id];   // "M" / "F"

const mbti = PERSONALITY_MBTI[params.personality_id]; // "INTJ"...
const personaText = PERSONALITY_TEXT[params.personality_id];

const purposeKey  = PURPOSE_KEY[params.purpose_id];   // "good_impression"
const purposeText = PURPOSE_TEXT[params.purpose_id];  // "Good Impression"

const fashionKey  = FASHION_STYLE_KEY[params.fashion_id];
const fashionText = FASHION_STYLE_TEXT[params.fashion_id];

const preferColor = PREFER_COLOR_TEXT[params.pref_color_id]; // "Pink" 등
const category    = CATEGORY_TEXT[params.category_id];       // "Floral" 등


---

좋아—요청하신 새 파라미터 세트( age, gender, **MBTI**, **purpose**, **fashion style**, **prefer color**, **category**)로 화면을 바꾸되, **Top/Middle/Base 노트는 그대로 유지**하도록 `PerfumeResult.jsx`에 바로 반영하는 패치 안내 드릴게요. 아래 그대로 붙여넣으면 됩니다.

---

# 1) 라벨(i18n) 키 추가/정리

**위치:** `DICT` 정의부에서 labels에 새 키들을 추가하세요. (기존 color/style 라벨은 더 이상 안 씀)

```diff
const DICT = {
  en: {
    labels: {
-     gender: "Gender", age: "Age", color: "Preferred Color", style: "Preferred Style",
-     top: "Top Note", middle: "Middle Note", base: "Base Note"
+     gender: "Gender",
+     mbti: "MBTI",
+     age: "Age",
+     fashion: "Fashion Style",
+     preferColor: "Preferred Color",
+     purpose: "Purpose",
+     category: "Category",
+     top: "Top Note", middle: "Middle Note", base: "Base Note"
    },
    title: "Best match for you",
    shareHashtags: (name) => `#perfume #${name}`,
    valueMaps: {
      gender: { female: "Female", male: "Male", unspecified: "Unspecified" },
      age: { "10s": "10s", "20s": "20s", "30s": "30s", "40s": "40s", "50s": "50s", "60s": "60s" },
-     color: { red: "Red", orange: "Orange", yellow: "Yellow", green: "Green", blue: "Blue", navy: "Navy", purple: "Purple" },
-     style: { fresh: "Fresh", sweet: "Sweet", romantic: "Romantic", sensual: "Sensual", urban: "Urban", cool: "Cool" },
+     // (참고) 기존 color/style은 더 이상 표시용으로 사용하지 않음
    }
  },
  ko: {
    labels: {
-     gender: "성별", age: "나이", color: "선호하는 색상", style: "선호하는 스타일",
-     top: "탑노트", middle: "미들노트", base: "베이스노트"
+     gender: "성별",
+     mbti: "MBTI",
+     age: "나이",
+     fashion: "패션 스타일",
+     preferColor: "선호 색상",
+     purpose: "사용 목적",
+     category: "향수 카테고리",
+     top: "탑노트", middle: "미들노트", base: "베이스노트"
    },
    title: "당신에게 어울리는",
    shareHashtags: (name) => `#향수추천 #${name}`,
    valueMaps: {
      gender: { female: "여자", male: "남자", unspecified: "미지정" },
      age: { "10s": "10대", "20s": "20대", "30s": "30대", "40s": "40대", "50s": "50대", "60s": "60대" },
-     color: { red: "빨간색", orange: "주황색", yellow: "노란색", green: "초록색", blue: "파란색", navy: "남색", purple: "보라색" },
-     style: { fresh: "시원함", sweet: "달콤함", romantic: "로맨틱", sensual: "관능적", urban: "도시적", cool: "시원함" },
+     // (참고) 기존 color/style은 더 이상 표시용으로 사용하지 않음
    }
  }
};
```

---

# 2) 새 매핑 상수 추가

**위치:** `DICT` 아래 유틸/상수 섹션에 추가하세요. (한/영 값 매핑 테이블)

```jsx
// === Lookup tables (URL 코드 → 표시 텍스트) ===
const AGE_GROUP_FROM_ID = { 0:"NONE",1:"10s",2:"20s",3:"30s",4:"40s",5:"50s",6:"50s" };
const GENDER_TEXT_EN = { 0:"None",1:"Man",2:"Woman" };
const GENDER_TEXT_KO = { 0:"None",1:"남자",2:"여자" };
const PERSONALITY_MBTI = { 0:"NONE",1:"ENFP",2:"INFP",3:"ISFP",4:"ISTJ",5:"ISFJ" };

const PURPOSE_TEXT = {
  en: { 0:"None",1:"Mood Boost",2:"Good Impression",3:"Unique Style",4:"Self Satisfaction",5:"Date or Social",6:"Formal Occasion",7:"Special Event" },
  ko: { 0:"없음",1:"기분 전환",2:"좋은 인상",3:"유니크 스타일",4:"자기 만족",5:"데이트/사교",6:"포멀한 자리",7:"특별한 날" }
};
const PREF_SCENT_TO_PURPOSE_KEY = {
  0:"good_impression",1:"mood_boost",2:"good_impression",3:"self_satisfaction",4:"date_or_social",
  5:"formal_occasion",6:"special_event",7:"unique_style",8:"mood_boost",9:"self_satisfaction",
  10:"formal_occasion",11:"special_event",12:"unique_style"
};
const PURPOSE_KEY_TO_TEXT = {
  en: {good_impression:"Good Impression",mood_boost:"Mood Boost",unique_style:"Unique Style",self_satisfaction:"Self Satisfaction",date_or_social:"Date or Social",formal_occasion:"Formal Occasion",special_event:"Special Event"},
  ko: {good_impression:"좋은 인상",mood_boost:"기분 전환",unique_style:"유니크 스타일",self_satisfaction:"자기 만족",date_or_social:"데이트/사교",formal_occasion:"포멀한 자리",special_event:"특별한 날"}
};

const FASHION_TEXT = {
  en: {0:"None",1:"Casual",2:"Chic",3:"Classic",4:"Free Style",5:"Lovely",6:"Minimal",7:"Modern",8:"Romantic",9:"Simple",10:"Sports"},
  ko: {0:"없음",1:"캐주얼",2:"시크",3:"클래식",4:"프리스타일",5:"러블리",6:"미니멀",7:"모던",8:"로맨틱",9:"심플",10:"스포츠"}
};

const PREFER_COLOR_TEXT = {
  en: {0:"None",1:"Blue",2:"Pink",3:"Coral",4:"Beige",5:"Brown",6:"Black",7:"Purple",8:"Red",9:"Yellow",10:"Orange",11:"Mint",12:"Green",13:"Gray",14:"White"},
  ko: {0:"없음",1:"블루",2:"핑크",3:"코랄",4:"베이지",5:"브라운",6:"블랙",7:"퍼플",8:"레드",9:"옐로우",10:"오렌지",11:"민트",12:"그린",13:"그레이",14:"화이트"}
};

const CATEGORY_TEXT = {
  en: {0:"None",1:"Aquatic",2:"Aromatic",3:"Casual",4:"Citrus",5:"Floral",6:"Fougère",7:"Fruity",8:"Green",9:"Light Floral",10:"Musk",11:"Spicy",12:"Woody"},
  ko: {0:"없음",1:"아쿠아틱",2:"아로마틱",3:"캐주얼",4:"시트러스",5:"플로럴",6:"푸제르",7:"프루티",8:"그린",9:"라이트 플로럴",10:"머스크",11:"스파이시",12:"우디"}
};
```

---

# 3) 값 파생 변수 교체 (새 파라미터 해석)

**위치:** 현재 `vGender, vAge, vColor, vStyle` 계산하는 부분을 **아래로 교체**하세요. (기존 4줄 제거)

```diff
- const vGender = valueMaps.gender[params.gender] ?? params.gender;
- const vAge = valueMaps.age[params.age] ?? params.age;
- const vColor = valueMaps.color[params.color] ?? params.color;
- const vStyle = valueMaps.style[params.style] ?? params.style;
+ // --- Gender: 문자열(female/male/unspecified) 또는 코드(gender_id=1/2) 모두 지원
+ const vGender = (() => {
+   if (params.gender != null) return valueMaps.gender[params.gender] ?? params.gender;
+   const gid = Number(params.gender_id);
+   if (!Number.isNaN(gid)) return (lang==='ko' ? GENDER_TEXT_KO : GENDER_TEXT_EN)[gid] ?? '';
+   return '';
+ })();
+
+ // --- Age: 문자열(20s 등) 또는 코드(age_id) 지원 → 언어별 표기로 변환
+ const vAge = (() => {
+   let grp = params.age;
+   if (!grp && params.age_id != null) grp = AGE_GROUP_FROM_ID[Number(params.age_id)];
+   return valueMaps.age[grp] ?? grp ?? '';
+ })();
+
+ // --- MBTI: 문자열(mbti) 또는 코드(personality) 지원
+ const vMbti = (() => {
+   const raw = params.mbti ?? PERSONALITY_MBTI[Number(params.personality)];
+   return (raw ? String(raw).toUpperCase() : '');
+ })();
+
+ // --- Fashion Style: 문자열(fashion) 또는 코드(fashion_id)
+ const vFashion = (() => {
+   const table = FASHION_TEXT[lang==='ko'?'ko':'en'];
+   if (params.fashion != null) {
+     const s = String(params.fashion).toLowerCase();
+     // 문자열이 오면 첫 글자만 대문자(or ko 그대로)
+     const rev = Object.entries(table).find(([,v]) => v.toLowerCase?.()===s);
+     return rev ? rev[1] : params.fashion;
+   }
+   const fid = Number(params.fashion_id);
+   if (!Number.isNaN(fid)) return table[fid] ?? '';
+   return '';
+ })();
+
+ // --- Preferred Color: 문자열(pref_color) 또는 코드(pref_color_id)
+ const vPreferColor = (() => {
+   const table = PREFER_COLOR_TEXT[lang==='ko'?'ko':'en'];
+   if (params.pref_color != null) {
+     const key = String(params.pref_color).toLowerCase();
+     const rev = Object.entries(table).find(([,v]) => v.toLowerCase?.()===key);
+     return rev ? rev[1] : params.pref_color;
+   }
+   const cid = Number(params.pref_color_id);
+   if (!Number.isNaN(cid)) return table[cid] ?? '';
+   return '';
+ })();
+
+ // --- Purpose: 코드(purpose_id) 또는 키(purpose) 또는 선호향코드(pref_scent)
+ const vPurpose = (() => {
+   const t = PURPOSE_TEXT[lang==='ko'?'ko':'en'];
+   if (params.purpose_id != null) return t[Number(params.purpose_id)] ?? '';
+   if (params.purpose != null)    return PURPOSE_KEY_TO_TEXT[lang==='ko'?'ko':'en'][String(params.purpose)] ?? String(params.purpose);
+   if (params.pref_scent != null) {
+     const key = PREF_SCENT_TO_PURPOSE_KEY[Number(params.pref_scent)];
+     return PURPOSE_KEY_TO_TEXT[lang==='ko'?'ko':'en'][key] ?? '';
+   }
+   return '';
+ })();
+
+ // --- Category: 문자열(category) 또는 코드(category_id)
+ const vCategory = (() => {
+   const table = CATEGORY_TEXT[lang==='ko'?'ko':'en'];
+   if (params.category != null) {
+     const key = String(params.category).toLowerCase();
+     const rev = Object.entries(table).find(([,v]) => v.toLowerCase?.()===key);
+     return rev ? rev[1] : params.category;
+   }
+   const cid = Number(params.category_id);
+   if (!Number.isNaN(cid)) return table[cid] ?? '';
+   return '';
+ })();
```

> 이렇게 하면 URL에 `&gender=female` 또는 `&gender_id=2`, `&age=30s` 또는 `&age_id=3`, `&mbti=INTJ` 또는 `&personality=4` 등 **여러 형식이 와도 자동 매핑**됩니다.

---

# 4) 등장 순서와 렌더 행 교체

**위치 A:** `rowOrder`를 새 키로 교체 (MBTI는 gender 다음, style/color는 제거)

```diff
- const rowOrder = ["gender", "age", "color", "style", "top", "middle", "base"];
+ const rowOrder = ["gender", "mbti", "age", "fashion", "preferColor", "purpose", "category", "top", "middle", "base"];
```

**위치 B:** `ROWS` 배열을 새로 교체

```diff
- const ROWS = [
-   { type: "text", key: "gender", valueFrom: () => vGender },
-   { type: "text", key: "age", valueFrom: () => vAge },
-   { type: "text", key: "color", valueFrom: () => vColor },
-   { type: "text", key: "style", valueFrom: () => vStyle },
-   { type: "note", key: "top", valueFrom: () => Number(params.top) || 0 },
-   { type: "note", key: "middle", valueFrom: () => Number(params.middle) || 0 },
-   { type: "note", key: "base", valueFrom: () => Number(params.base) || 0 },
- ];
+ const ROWS = [
+   { type: "text", key: "gender",      valueFrom: () => vGender },
+   { type: "text", key: "mbti",        valueFrom: () => vMbti },
+   { type: "text", key: "age",         valueFrom: () => vAge },
+   { type: "text", key: "fashion",     valueFrom: () => vFashion },
+   { type: "text", key: "preferColor", valueFrom: () => vPreferColor },
+   { type: "text", key: "purpose",     valueFrom: () => vPurpose },
+   { type: "text", key: "category",    valueFrom: () => vCategory },
+   { type: "note", key: "top",         valueFrom: () => Number(params.top) || 0 },
+   { type: "note", key: "middle",      valueFrom: () => Number(params.middle) || 0 },
+   { type: "note", key: "base",        valueFrom: () => Number(params.base) || 0 },
+ ];
```

> 이로써 **중복되는 건 유지(=gender, age, 노트 3종)**, **없는 건 삭제(=기존 color/style)**, **필요한 건 추가(MBTI, fashion, prefer color, purpose, category)**가 반영됩니다.

---

# 5) 공유 텍스트 버그 1줄 수정

현재 Web Share에서 `item.title`을 참조하고 있는데, 데이터에서 `title`을 제거한 상태라 오류가 날 수 있어요. **`dict.title`로 교체**하세요.

```diff
- text: `${item.subTitle} - ${item.title}`,
+ text: `${item.subTitle} - ${dict.title}`,
```

---

# 6) 사용 예시 (URL 쿼리)

이제 아래와 같은 조합이 **그대로 화면에 반영**됩니다.

- 영문 + 코드 기반:
    

```
...?perfume=1&gender_id=2&age_id=3&personality=4&fashion_id=2&pref_color_id=11&purpose_id=5&category_id=5&top=70&middle=40&base=20&lang=en
```

- 국문 + 문자열 기반:
    

```
...?perfume=2&gender=female&age=20s&mbti=INFP&fashion=캐주얼&pref_color=Pink&purpose=good_impression&category=Floral&top=60&middle=55&base=35&lang=ko
```

---

## 끝! 체크리스트

-  화면의 파라미터 행이 `성별 → MBTI → 나이 → 패션 스타일 → 선호 색상 → 사용 목적 → 향수 카테고리 → (노트 3종)` 순으로 애니메이션 등장하는지
    
-  `&lang=en/ko` 전환 시 값과 라벨이 언어별로 잘 표시되는지
    
-  오래된 `color/style` 행이 사라졌는지
    

필요하면 같은 패치로 `frSmart.css`는 건드릴 필요 없어요. 적용 중 막히는 줄 위치 나오면 알려줘—해당 블록만 다시 정리해서 줄게.